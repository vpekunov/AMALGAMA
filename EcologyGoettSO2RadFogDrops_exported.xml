<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE System [
<!ELEMENT System (Elements)>
<!ATTLIST System
Lang CDATA #REQUIRED
>
<!ELEMENT Elements (Element*)>
<!ATTLIST Elements
NumItems CDATA #REQUIRED
>
<!ELEMENT Element (Show,Position,Parameters,InternalInputs,InternalOutputs,PublishedInputs,PublishedOutputs,InputLinks,OutputLinks)>
<!ATTLIST Element
ClassID CDATA #REQUIRED
ParentID CDATA #REQUIRED
ID ID #REQUIRED
Permanent (True | False) #REQUIRED
>
<!ELEMENT Show EMPTY>
<!ATTLIST Show
Class (True | False) #REQUIRED
Name (True | False) #REQUIRED
Image (True | False) #REQUIRED
>
<!ELEMENT Position EMPTY>
<!ATTLIST Position
Left CDATA #REQUIRED
Top CDATA #REQUIRED
>
<!ELEMENT Parameters (Parameter*)>
<!ATTLIST Parameters
NumItems CDATA #REQUIRED
>
<!ELEMENT Parameter (#PCDATA | EMPTY)*>
<!ATTLIST Parameter
ID CDATA #REQUIRED
Indent CDATA #IMPLIED
>
<!ELEMENT InternalInputs (iContact*)>
<!ATTLIST InternalInputs
NumItems CDATA #REQUIRED
>
<!ELEMENT InternalOutputs (iContact*)>
<!ATTLIST InternalOutputs
NumItems CDATA #REQUIRED
>
<!ELEMENT iContact EMPTY>
<!ATTLIST iContact
ID CDATA #REQUIRED
ElementID IDREF #REQUIRED
ContID CDATA #REQUIRED
>
<!ELEMENT PublishedInputs (pContact*)>
<!ATTLIST PublishedInputs
NumItems CDATA #REQUIRED
>
<!ELEMENT PublishedOutputs (pContact*)>
<!ATTLIST PublishedOutputs
NumItems CDATA #REQUIRED
>
<!ELEMENT pContact EMPTY>
<!ATTLIST pContact
ID CDATA #REQUIRED
PublicID CDATA #REQUIRED
PublicName CDATA #REQUIRED
>
<!ELEMENT InputLinks (Contact*)>
<!ELEMENT OutputLinks (Contact*)>
<!ELEMENT Contact (Link*)>
<!ATTLIST Contact
ID CDATA #REQUIRED
>
<!ELEMENT Link (Points?)>
<!ATTLIST Link
ElementID IDREF #REQUIRED
ContID CDATA #REQUIRED
Color CDATA #IMPLIED
Informational (True | False) #REQUIRED
>
<!ELEMENT Points (#PCDATA | EMPTY)*>
<!ATTLIST Points
NumItems CDATA #REQUIRED
>
]>
<System Lang="">
 <Elements NumItems="103">
  <Element ClassID="clsE_Phase" ParentID="" ID="MainPhase" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="193" Top="106"/>
   <Parameters NumItems="3">
    <Parameter ID="Uw" Indent="0">0</Parameter>
    <Parameter ID="Source" Indent="0"></Parameter>
    <Parameter ID="Nc" Indent="0">1</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Model">
     <Link ElementID="Model" ContID="Carrier" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Nu">
     <Link ElementID="K_E_With_GbT" ContID="tNu" Color="#808040" Informational="False">
      <Points NumItems="3">361,148,389,69,446,38</Points>
     </Link>
    </Contact>
    <Contact ID="T">
     <Link ElementID="T" ContID="PhasePrm" Color="clPurple" Informational="False">
      <Points NumItems="4">369,165,369,3,718,3,718,28</Points>
     </Link>
    </Contact>
    <Contact ID="U">
     <Link ElementID="P_U" ContID="PrmU" Color="#0080FF" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
    <Contact ID="Define">
     <Link ElementID="P_U" ContID="PhaseU" Color="#8000FF" Informational="False">
      <Points NumItems="0"/>
     </Link>
     <Link ElementID="P_U" ContID="PhaseP" Color="#8000FF" Informational="False">
      <Points NumItems="2">438,242,464,307</Points>
     </Link>
     <Link ElementID="K_E_With_GbT" ContID="NuPhase" Color="#8000FF" Informational="False">
      <Points NumItems="2">395,75,432,55</Points>
     </Link>
     <Link ElementID="K_E_With_GbT" ContID="KtPhase" Color="#8000FF" Informational="False">
      <Points NumItems="2">392,146,456,146</Points>
     </Link>
     <Link ElementID="K_E_With_GbT" ContID="EtPhase" Color="#8000FF" Informational="False">
      <Points NumItems="2">397,155,458,155</Points>
     </Link>
     <Link ElementID="SO2" ContID="Phase" Color="#8000FF" Informational="False">
      <Points NumItems="1">349,934</Points>
     </Link>
     <Link ElementID="FUV" ContID="Phase" Color="#8000FF" Informational="False">
      <Points NumItems="1">349,1030</Points>
     </Link>
     <Link ElementID="UV" ContID="Phase" Color="#8000FF" Informational="False">
      <Points NumItems="1">349,1130</Points>
     </Link>
     <Link ElementID="F0" ContID="Phase" Color="#8000FF" Informational="False">
      <Points NumItems="1">349,1283</Points>
     </Link>
     <Link ElementID="I" ContID="Phase" Color="#8000FF" Informational="False">
      <Points NumItems="1">349,1341</Points>
     </Link>
     <Link ElementID="FIR" ContID="Phase" Color="#8000FF" Informational="False">
      <Points NumItems="1">349,1454</Points>
     </Link>
     <Link ElementID="IR" ContID="Phase" Color="#8000FF" Informational="False">
      <Points NumItems="1">349,1524</Points>
     </Link>
     <Link ElementID="IRt" ContID="Phase" Color="#8000FF" Informational="False">
      <Points NumItems="1">349,1666</Points>
     </Link>
     <Link ElementID="T" ContID="Phase" Color="#8000FF" Informational="False">
      <Points NumItems="4">504,219,575,174,710,174,710,44</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Solver" ParentID="" ID="Solver" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="922" Top="302"/>
   <Parameters NumItems="1">
    <Parameter ID="Functions" Indent="0">/* Аналитическое решение */
double aGetXY(double D, double RR)
{
 double D2 = D*D;
 double D3 = D*D2;
 double D6 = D3*D3;
 double z = pow(-80.0*D3+108.0*RR+12.0*sqrt(48.0*D6-120.0*D3*RR+81.0*RR*RR),1.0/3.0);
 return z/6.0-4.0/3.0*D2/z-D/3.0;
}

/* Численное решение */
double GetXY(double D, double RR)
{
	double dx;
	double aResult = aGetXY(D, RR);
	double Result = isfinite(aResult) ? aResult : D;
	int    Counter = 0;

	do {
		double z1 = D*D + Result*Result;
		double z2 = D + Result;
		dx = -(z1*z2 - RR) / (2.0*Result*z2 + z1);
		Result += 0.5*dx;
	} while (isfinite(Result) &amp;&amp; fabs(dx) &gt;= D*0.0000001 &amp;&amp; ++Counter&lt;5);
	return Counter&lt;5 &amp;&amp; isfinite(Result) ? Result : isfinite(aResult) ? aResult : D;
}

double CD(double Re)
{
 if (Re&lt;0.001) return CD(0.001);
 else if (Re&lt;0.1) return 24.0/Re;
 else if (Re&lt;1.0) return 24.0/Re*(1.0+3.0/16.0*Re+9.0/160.0*Re*Re*log(2*Re));
 else if (Re&lt;900.0) return 24.0/Re*(1+0.15*pow(Re,0.678));
 else return 0.44;
}

double FFk(double g, double RO, double ROK, double Sigma, double Nu, double D, double dU)
{
 double adU = fabs(dU);
 double Re = D*adU/Nu;
 double We = 0.5*RO*D*dU*dU/Sigma;

 return 3.0/8.0*CD(Re)*(1.0+2.632*We/12.0)*RO/ROK*2.0/D*adU*dU-g;
}

double GetdU(double g, double RO, double ROK, double Sigma, double Nu, double D, double Init_dU)
{
	double dx;
	double Result = Init_dU;
	int    Counter = 0;

	if (!isfinite(Init_dU) || fabs(Init_dU) &gt; 25) Init_dU = 0.0;

	do {
		double FF = FFk(g, RO, ROK, Sigma, Nu, D, Result);
		double FF1 = FFk(g, RO, ROK, Sigma, Nu, D, Result + 0.00001);
		dx = -FF / (FF1 - FF)*0.00001;
		Result += min(1.5, 0.5*dx);
	} while (fabs(dx) &gt;= 0.0001 &amp;&amp; (++Counter&lt;80) &amp;&amp; isfinite(Result) &amp;&amp; fabs(Result) &lt; 25 + fabs(Init_dU));

	Result = Counter &gt;= 80 || !isfinite(Result) || fabs(Result) &gt; 25 + fabs(Init_dU) ? Init_dU : Result;

	return Result;
}

double getLeftSpline(int i, double * Dk, double * XYC, double * XYC2, double * XYC3, double * XYC4, double * XYC5,
	double * XYC6, double * XYC7, double ROK, double * AnC, double * BnC,
	double * Ann, double * Bnn, double * Cnn, double * Dnn) {

	double Pi = 3.1415926535897932;

	double MAT[4][4];
	double LU[4][4]; 
	double FMAT[4]; 
	double XMAT[4];
	int iRow[4];

	MAT[0][0] = XYC3[i - 1];
	MAT[0][1] = XYC2[i - 1];
	MAT[0][2] = XYC[i - 1];
	MAT[0][3] = 1.0;
	FMAT[0] = AnC[i - 1] * XYC[i - 1] + BnC[i - 1];
	MAT[1][0] = XYC3[i];
	MAT[1][1] = XYC2[i];
	MAT[1][2] = XYC[i];
	MAT[1][3] = 1.0;
	FMAT[1] = AnC[i] * XYC[i] + BnC[i];
	MAT[2][0] = 1.0 / 4.0*(XYC4[i] - XYC4[i - 1]);
	MAT[2][1] = 1.0 / 3.0*(XYC3[i] - XYC3[i - 1]);
	MAT[2][2] = 1.0 / 2.0*(XYC2[i] - XYC2[i - 1]);
	MAT[2][3] = XYC[i] - XYC[i - 1];
	FMAT[2] = AnC[i - 1] / 2.0*(Dk[i] * Dk[i] - XYC2[i - 1]) + BnC[i - 1] * (Dk[i] - XYC[i - 1]) +
		AnC[i] / 2.0*(XYC2[i] - Dk[i] * Dk[i]) + BnC[i] * (XYC[i] - Dk[i]);
	MAT[3][0] = Pi / 6.0*ROK*1.0 / 7.0*(XYC7[i] - XYC7[i - 1]);
	MAT[3][1] = Pi / 6.0*ROK*1.0 / 6.0*(XYC6[i] - XYC6[i - 1]);
	MAT[3][2] = Pi / 6.0*ROK*1.0 / 5.0*(XYC5[i] - XYC5[i - 1]);
	MAT[3][3] = Pi / 6.0*ROK*1.0 / 4.0*(XYC4[i] - XYC4[i - 1]);
	FMAT[3] = Pi / 6.0*ROK*(AnC[i - 1] / 5.0*(Dk[i] * Dk[i] * Dk[i] * Dk[i] * Dk[i] - XYC5[i - 1]) + BnC[i - 1] / 4.0*(Dk[i] * Dk[i] * Dk[i] * Dk[i] - XYC4[i - 1]) +
		AnC[i] / 5.0*(XYC5[i] - Dk[i] * Dk[i] * Dk[i] * Dk[i] * Dk[i]) + BnC[i] / 4.0*(XYC4[i] - Dk[i] * Dk[i] * Dk[i] * Dk[i]));

	_GetLU(4, iRow, (double *)MAT, (double *)LU);
	_SolveLU(4, iRow, (double *)LU, FMAT, XMAT);

	Ann[i] = XMAT[0];
	Bnn[i] = XMAT[1];
	Cnn[i] = XMAT[2];
	Dnn[i] = XMAT[3];

	return Ann[i];
}

double getRightSpline(int i, double * Dk, double * XYC, double * XYC2, double * XYC3, double * XYC4, double * XYC5,
	double * XYC6, double * XYC7, double ROK, double * AnC, double * BnC,
	double * An, double * Bn, double * Cn, double * Dn) {

	double Pi = 3.1415926535897932;

	double MAT[4][4];
	double LU[4][4];
	double FMAT[4];
	double XMAT[4];
	int iRow[4];

	MAT[0][0] = XYC3[i];
	MAT[0][1] = XYC2[i];
	MAT[0][2] = XYC[i];
	MAT[0][3] = 1.0;
	FMAT[0] = AnC[i] * XYC[i] + BnC[i];
	MAT[1][0] = XYC3[i + 1];
	MAT[1][1] = XYC2[i + 1];
	MAT[1][2] = XYC[i + 1];
	MAT[1][3] = 1.0;
	FMAT[1] = AnC[i + 1] * XYC[i + 1] + BnC[i + 1];
	MAT[2][0] = 1.0 / 4.0*(XYC4[i + 1] - XYC4[i]);
	MAT[2][1] = 1.0 / 3.0*(XYC3[i + 1] - XYC3[i]);
	MAT[2][2] = 1.0 / 2.0*(XYC2[i + 1] - XYC2[i]);
	MAT[2][3] = XYC[i + 1] - XYC[i];
	FMAT[2] = AnC[i] / 2.0*(Dk[i + 1] * Dk[i + 1] - XYC2[i]) + BnC[i] * (Dk[i + 1] - XYC[i]) +
		AnC[i + 1] / 2.0*(XYC2[i + 1] - Dk[i + 1] * Dk[i + 1]) + BnC[i + 1] * (XYC[i + 1] - Dk[i + 1]);
	MAT[3][0] = Pi / 6.0*ROK*1.0 / 7.0*(XYC7[i + 1] - XYC7[i]);
	MAT[3][1] = Pi / 6.0*ROK*1.0 / 6.0*(XYC6[i + 1] - XYC6[i]);
	MAT[3][2] = Pi / 6.0*ROK*1.0 / 5.0*(XYC5[i + 1] - XYC5[i]);
	MAT[3][3] = Pi / 6.0*ROK*1.0 / 4.0*(XYC4[i + 1] - XYC4[i]);
	FMAT[3] = Pi / 6.0*ROK*(AnC[i] / 5.0*(Dk[i + 1] * Dk[i + 1] * Dk[i + 1] * Dk[i + 1] * Dk[i + 1] - XYC5[i]) + BnC[i] / 4.0*(Dk[i + 1] * Dk[i + 1] * Dk[i + 1] * Dk[i + 1] - XYC4[i]) +
		AnC[i + 1] / 5.0*(XYC5[i + 1] - Dk[i + 1] * Dk[i + 1] * Dk[i + 1] * Dk[i + 1] * Dk[i + 1]) + BnC[i + 1] / 4.0*(XYC4[i + 1] - Dk[i + 1] * Dk[i + 1] * Dk[i + 1] * Dk[i + 1]));

	_GetLU(4, iRow, (double *)MAT, (double *)LU);
	_SolveLU(4, iRow, (double *)LU, FMAT, XMAT);

	An[i] = XMAT[0];
	Bn[i] = XMAT[1];
	Cn[i] = XMAT[2];
	Dn[i] = XMAT[3];

	return An[i];
}

double calcCoalescense(int Nc, double * Dk, double * X, double * Y, double * XYC,
	double * Ann, double * Bnn, double * Cnn, double * Dnn,
	double * An, double * Bn, double * Cn, double * Dn,
	int Ptr,
	float ** UX, float ** UY, float ** UZ,
	double * UwLight,
	double ROK,
	double * ddN, double * dRo, double * ddRo /* [Nc][Nc+1] */) {
	double Pi = 3.1415926535897932;

	int i, j;

	if (ddRo)
		for (i = 0, Ptr = 0; i &lt; Nc; i++)
			for (j = 0; j &lt;= Nc; j++, Ptr++)
				ddRo[Ptr] = 0.0;

	for (i = 0; i &lt; Nc; i++)
		for (j = i; j &lt; Nc; j++) {
			double h1 = Y[i] - X[i];
			double h2 = Y[j] - X[j];
			double D11 = X[i];
			double D12 = D11 + h1 / 2;
			double D13 = D11 + h1;
			double D21 = X[j];
			double D22 = D21 + h2 / 2;
			double D23 = D21 + h2;

			double N11 = D11 &lt;= XYC[i] ? ((Ann[i] * D11 + Bnn[i])*D11 + Cnn[i])*D11 + Dnn[i] :
				((An[i] * D11 + Bn[i])*D11 + Cn[i])*D11 + Dn[i];
			double N12 = D12 &lt;= XYC[i] ? ((Ann[i] * D12 + Bnn[i])*D12 + Cnn[i])*D12 + Dnn[i] :
				((An[i] * D12 + Bn[i])*D12 + Cn[i])*D12 + Dn[i];
			double N13 = D13 &lt;= XYC[i] ? ((Ann[i] * D13 + Bnn[i])*D13 + Cnn[i])*D13 + Dnn[i] :
				((An[i] * D13 + Bn[i])*D13 + Cn[i])*D13 + Dn[i];
			double N21 = D21 &lt;= XYC[j] ? ((Ann[j] * D21 + Bnn[j])*D21 + Cnn[j])*D21 + Dnn[j] :
				((An[j] * D21 + Bn[j])*D21 + Cn[j])*D21 + Dn[j];
			double N22 = D22 &lt;= XYC[j] ? ((Ann[j] * D22 + Bnn[j])*D22 + Cnn[j])*D22 + Dnn[j] :
				((An[j] * D22 + Bn[j])*D22 + Cn[j])*D22 + Dn[j];
			double N23 = D23 &lt;= XYC[j] ? ((Ann[j] * D23 + Bnn[j])*D23 + Cnn[j])*D23 + Dnn[j] :
				((An[j] * D23 + Bn[j])*D23 + Cn[j])*D23 + Dn[j];

			if (N11 &gt; 1E-5 &amp;&amp; N12 &gt; 1E-5 &amp;&amp; N13 &gt; 1E-5 &amp;&amp; N21 &gt; 1E-5 &amp;&amp; N22 &gt; 1E-5 &amp;&amp; N23 &gt; 1E-5) {
				double dQ = Pi / 4.0*sqrt((UX[i][Ptr] - UX[j][Ptr])*(UX[i][Ptr] - UX[j][Ptr]) +
										(UY[i][Ptr] - UY[j][Ptr])*(UY[i][Ptr] - UY[j][Ptr]) +
										(UZ[i][Ptr] - UZ[j][Ptr])*(UZ[i][Ptr] - UZ[j][Ptr]))*
					(
					h1 / 6.0*(N11*(h2 / 6.0*(N21*(D11 + D21)*(D11 + D21) + 4 * N22*(D11 + D22)*(D11 + D22) + N23*(D11 + D23)*(D11 + D23))) +
					4 * N12*(h2 / 6.0*(N21*(D12 + D21)*(D12 + D21) + 4 * N22*(D12 + D22)*(D12 + D22) + N23*(D12 + D23)*(D12 + D23))) +
					N13*(h2 / 6.0*(N21*(D13 + D21)*(D13 + D21) + 4 * N22*(D13 + D22)*(D13 + D22) + N23*(D13 + D23)*(D13 + D23))))
					);
				if (dQ &gt; 0.0) {
					double D3;
					int G;
					int found;
					D13 = (N11*D11*D11*D11 + 4 * N12*D12*D12*D12 + N13*D13*D13*D13) / (N11 + 4 * N12 + N13);
					D23 = (N21*D21*D21*D21 + 4 * N22*D22*D22*D22 + N23*D23*D23*D23) / (N21 + 4 * N22 + N23);
					D3 = pow(D13 + D23, 1.0 / 3.0);

					G = 0;
					found = 0;

					while (G &lt; Nc &amp;&amp; !found)
						if (Dk[G + 1] &gt; D3)
							found = 1;
						else
							G++;

					ddN[i] -= dQ;
					ddN[j] -= dQ;
					dRo[i] -= dQ*ROK*Pi / 6.0*D13;
					dRo[j] -= dQ*ROK*Pi / 6.0*D23;
					if (G &lt; Nc) {
						ddN[G] += dQ;
						dRo[G] += dQ*ROK*Pi / 6.0*D13;
						dRo[G] += dQ*ROK*Pi / 6.0*D23;
					}
					if (ddRo) {
						ddRo[i*(Nc+1)+Nc] -= dQ*ROK*Pi / 6.0*D13;
						ddRo[j*(Nc+1)+Nc] -= dQ*ROK*Pi / 6.0*D23;
						if (G &lt; Nc) {
							ddRo[i*(Nc+1)+G] += dQ*ROK*Pi / 6.0*D13;
							ddRo[j*(Nc+1)+G] += dQ*ROK*Pi / 6.0*D23;
						}
					}
				}
			}
		}

	return 0.0;
}
</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Eqtn">
     <Link ElementID="P_U" ContID="SolveP" Informational="False"/>
     <Link ElementID="P_U" ContID="SolveUx" Informational="False"/>
     <Link ElementID="P_U" ContID="SolveUy" Informational="False"/>
     <Link ElementID="P_U" ContID="SolveUz" Informational="False"/>
     <Link ElementID="K_E_With_GbT" ContID="KtSolve" Informational="False"/>
     <Link ElementID="K_E_With_GbT" ContID="EtSolve" Informational="False"/>
     <Link ElementID="K_E_With_GbT" ContID="NuSolve" Informational="False"/>
     <Link ElementID="EqFUV" ContID="Solver" Informational="False"/>
     <Link ElementID="EqUV" ContID="Solver" Informational="False"/>
     <Link ElementID="EqF0" ContID="Solver" Informational="False"/>
     <Link ElementID="EqI" ContID="Solver" Informational="False"/>
     <Link ElementID="EqFIR" ContID="Solver" Informational="False"/>
     <Link ElementID="EqIR" ContID="Solver" Informational="False"/>
     <Link ElementID="EqIRt" ContID="Solver" Informational="False"/>
     <Link ElementID="EqT" ContID="Solver" Informational="False"/>
     <Link ElementID="EqRok" ContID="Solver" Informational="False"/>
     <Link ElementID="EqUkx" ContID="Solver" Informational="False"/>
     <Link ElementID="EqUky" ContID="Solver" Informational="False"/>
     <Link ElementID="EqUkz" ContID="Solver" Informational="False"/>
     <Link ElementID="EqNk" ContID="Solver" Informational="False"/>
     <Link ElementID="EqSO2k" ContID="Solver" Informational="False"/>
    </Contact>
    <Contact ID="Modify">
     <Link ElementID="EqSO2" ContID="Solver" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks/>
  </Element>
  <Element ClassID="clsE_Model" ParentID="" ID="Model" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="1" Top="336"/>
   <Parameters NumItems="0"/>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Carrier">
     <Link ElementID="MainPhase" ContID="Model" Color="clRed" Informational="False">
      <Points NumItems="2">160,361,160,137</Points>
     </Link>
    </Contact>
    <Contact ID="Other">
     <Link ElementID="Drops" ContID="Model" Color="clGreen" Informational="False">
      <Points NumItems="2">160,378,160,1794</Points>
     </Link>
    </Contact>
    <Contact ID="Control">
     <Link ElementID="K_E_With_GbT" ContID="tNu" Color="#404080" Informational="True">
      <Points NumItems="2">182,395,182,38</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_PU" ParentID="" ID="P_U" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="559" Top="197"/>
   <Parameters NumItems="0"/>
   <InternalInputs NumItems="10">
     <iContact ID="PrmU" ElementID="U" ContID="PhasePrm"/>
     <iContact ID="PhaseU" ElementID="U" ContID="Phase"/>
     <iContact ID="KoeffP" ElementID="P_U_EqP" ContID="K"/>
     <iContact ID="BoundP" ElementID="P_U_EqP" ContID="Bound"/>
     <iContact ID="PrmP" ElementID="P" ContID="PhasePrm"/>
     <iContact ID="PhaseP" ElementID="P" ContID="Phase"/>
     <iContact ID="BoundUx" ElementID="P_U_EqUx" ContID="Bound"/>
     <iContact ID="BoundUy" ElementID="P_U_EqUy" ContID="Bound"/>
     <iContact ID="KoeffUz" ElementID="P_U_EqUz" ContID="K"/>
     <iContact ID="BoundUz" ElementID="P_U_EqUz" ContID="Bound"/>
   </InternalInputs>
   <InternalOutputs NumItems="4">
     <iContact ID="SolveP" ElementID="P_U_EqP" ContID="Solver"/>
     <iContact ID="SolveUx" ElementID="P_U_EqUx" ContID="Solver"/>
     <iContact ID="SolveUy" ElementID="P_U_EqUy" ContID="Solver"/>
     <iContact ID="SolveUz" ElementID="P_U_EqUz" ContID="Solver"/>
   </InternalOutputs>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="PrmU">
     <Link ElementID="MainPhase" ContID="U" Informational="False"/>
    </Contact>
    <Contact ID="PhaseU">
     <Link ElementID="MainPhase" ContID="Define" Informational="False"/>
    </Contact>
    <Contact ID="KoeffP">
     <Link ElementID="K_T_P" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="PhaseP">
     <Link ElementID="MainPhase" ContID="Define" Informational="False"/>
    </Contact>
    <Contact ID="BoundUx">
     <Link ElementID="B_Ux" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="BoundUy">
     <Link ElementID="B_Uy" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="KoeffUz">
     <Link ElementID="K_T_Uz" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="SolveP">
     <Link ElementID="Solver" ContID="Eqtn" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
    <Contact ID="SolveUx">
     <Link ElementID="Solver" ContID="Eqtn" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
    <Contact ID="SolveUy">
     <Link ElementID="Solver" ContID="Eqtn" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
    <Contact ID="SolveUz">
     <Link ElementID="Solver" ContID="Eqtn" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Vector" ParentID="P_U" ID="U" Permanent="True">
   <Show Class="True" Name="True" Image="False"/>
   <Position Left="407" Top="139"/>
   <Parameters NumItems="2">
    <Parameter ID="FBase" Indent="0">v</Parameter>
    <Parameter ID="Desc" Indent="0">Скорость</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Vx">
     <Link ElementID="Ux" ContID="Vector" Color="#FF8000" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
    <Contact ID="Vy">
     <Link ElementID="Uy" ContID="Vector" Color="#FF8000" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
    <Contact ID="Vz">
     <Link ElementID="Uz" ContID="Vector" Color="#FF8000" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Projection" ParentID="P_U" ID="Ux" Permanent="True">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="589" Top="150"/>
   <Parameters NumItems="2">
    <Parameter ID="Init" Indent="0">double KScale = 0.208816;
double Uref = KScale*0.5263;
double Z0 = 0.05;
double ZZ = z==0 &amp;&amp; _Z[0]==0.0 ? Z0 : (_Z[z]+_Z[z-1])*0.5+Z0;
double K0 = Uref*ZZ;
double K1 = log(ZZ/Z0);

Result = 2.5*@Kx*Uref*K1;
</Parameter>
    <Parameter ID="Restrict" Indent="0">Any</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Vector">
     <Link ElementID="U" ContID="Vx" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="P_U_EqUx" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Projection" ParentID="P_U" ID="Uy" Permanent="True">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="588" Top="208"/>
   <Parameters NumItems="2">
    <Parameter ID="Init" Indent="0">double KScale = 0.208816;
double Uref = KScale*0.5263;
double Z0 = 0.05;
double ZZ = z==0 &amp;&amp; _Z[0]==0.0 ? Z0 : (_Z[z]+_Z[z-1])*0.5+Z0;
double K0 = Uref*ZZ;
double K1 = log(ZZ/Z0);

Result = 2.5*@Ky*Uref*K1;
</Parameter>
    <Parameter ID="Restrict" Indent="0">Any</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Vector">
     <Link ElementID="U" ContID="Vy" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="P_U_EqUy" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Projection" ParentID="P_U" ID="Uz" Permanent="True">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="586" Top="269"/>
   <Parameters NumItems="2">
    <Parameter ID="Init" Indent="0">0</Parameter>
    <Parameter ID="Restrict" Indent="0">Any</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Vector">
     <Link ElementID="U" ContID="Vz" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="P_U_EqUz" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="P_U" ID="P_U_K_Ux" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="739" Top="173"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0"></Parameter>
    <Parameter ID="Expression" Indent="0">Split{0.0,-1.0/@RO*dFdx(P)};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="P_U_EqUx" ContID="K" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="P_U" ID="P_U_K_Uy" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="714" Top="257"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0"></Parameter>
    <Parameter ID="Expression" Indent="0">Split{0.0,-1.0/@RO*dFdy(P)};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="P_U_EqUy" ContID="K" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="P_U" ID="P_U_K_Uz" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="704" Top="346"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0"></Parameter>
    <Parameter ID="Expression" Indent="0">Split{0.0,-1.0/@RO*dFdz(P)};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="P_U_EqUz" ContID="K" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="P_U" ID="P_U_K_P" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="621" Top="485"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double dUxdx = Split{0.0,dFdx(Ux)};
double dUydy = Split{0.0,dFdy(Uy)};
double dUzdz = Split{0.0,dFdz(Uz)};

double dUxdy = Split{0.0,dFdy(Ux)};
double dUydz = Split{0.0,dFdz(Uy)};
double dUzdx = Split{0.0,dFdx(Uz)};

double dUxdz = Split{0.0,dFdz(Ux)};
double dUydx = Split{0.0,dFdx(Uy)};
double dUzdy = Split{0.0,dFdy(Uz)};
</Parameter>
    <Parameter ID="Expression" Indent="0">Result = Split{0.0,-@RO*(dUxdx*dUxdx+dUydy*dUydy+dUzdz*dUzdz+
                            2.0*(dUydx*dUxdy+dUydz*dUzdy+dUxdz*dUzdx)
                            -0.1*DIV/TAU
                            -d2NFdx2(Nu,DIV)
                            -d2NFdy2(Nu,DIV)
                            -d2NFdz2(Nu,DIV))};
</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="P_U_EqP" ContID="K" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_PoissonEquation" ParentID="P_U" ID="P_U_EqP" Permanent="False">
   <Show Class="True" Name="True" Image="False"/>
   <Position Left="843" Top="423"/>
   <Parameters NumItems="3">
    <Parameter ID="Handler" Indent="0">PoissonSolver</Parameter>
    <Parameter ID="NuMol" Indent="0">0.0</Parameter>
    <Parameter ID="Kappa" Indent="0">0.0</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="P" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="P_U_K_P" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks/>
  </Element>
  <Element ClassID="clsE_Var" ParentID="P_U" ID="P" Permanent="True">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="569" Top="394"/>
   <Parameters NumItems="4">
    <Parameter ID="Init" Indent="0">0</Parameter>
    <Parameter ID="Restrict" Indent="0">Any</Parameter>
    <Parameter ID="FBase" Indent="0">p</Parameter>
    <Parameter ID="Desc" Indent="0">Давление</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="P_U_EqP" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_DynEquation" ParentID="P_U" ID="P_U_EqUx" Permanent="False">
   <Show Class="True" Name="True" Image="False"/>
   <Position Left="843" Top="86"/>
   <Parameters NumItems="3">
    <Parameter ID="Handler" Indent="0">NULL</Parameter>
    <Parameter ID="NuMol" Indent="0">@D</Parameter>
    <Parameter ID="Kappa" Indent="0">1</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="Ux" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="P_U_K_Ux" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks/>
  </Element>
  <Element ClassID="clsE_DynEquation" ParentID="P_U" ID="P_U_EqUy" Permanent="False">
   <Show Class="True" Name="True" Image="False"/>
   <Position Left="843" Top="200"/>
   <Parameters NumItems="3">
    <Parameter ID="Handler" Indent="0">NULL</Parameter>
    <Parameter ID="NuMol" Indent="0">@D</Parameter>
    <Parameter ID="Kappa" Indent="0">1</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="Uy" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="P_U_K_Uy" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks/>
  </Element>
  <Element ClassID="clsE_DynEquation" ParentID="P_U" ID="P_U_EqUz" Permanent="False">
   <Show Class="True" Name="True" Image="False"/>
   <Position Left="843" Top="312"/>
   <Parameters NumItems="3">
    <Parameter ID="Handler" Indent="0">NULL</Parameter>
    <Parameter ID="NuMol" Indent="0">@D</Parameter>
    <Parameter ID="Kappa" Indent="0">1</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="Uz" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="P_U_K_Uz" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks/>
  </Element>
  <Element ClassID="clsE_Turb_K_E" ParentID="" ID="K_E_With_GbT" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="540" Top="13"/>
   <Parameters NumItems="0"/>
   <InternalInputs NumItems="7">
     <iContact ID="tNu" ElementID="Nu" ContID="PhasePrm"/>
     <iContact ID="NuPhase" ElementID="Nu" ContID="Phase"/>
     <iContact ID="KtBound" ElementID="K_E_With_GbT_EqKt" ContID="Bound"/>
     <iContact ID="EtBound" ElementID="K_E_With_GbT_EqEt" ContID="Bound"/>
     <iContact ID="KtPhase" ElementID="Kt" ContID="Phase"/>
     <iContact ID="EtPhase" ElementID="Et" ContID="Phase"/>
     <iContact ID="NuBound" ElementID="K_E_With_GbT_EqNu" ContID="Bound"/>
   </InternalInputs>
   <InternalOutputs NumItems="4">
     <iContact ID="Val" ElementID="Nu" ContID="Val"/>
     <iContact ID="KtSolve" ElementID="K_E_With_GbT_EqKt" ContID="Solver"/>
     <iContact ID="EtSolve" ElementID="K_E_With_GbT_EqEt" ContID="Solver"/>
     <iContact ID="NuSolve" ElementID="K_E_With_GbT_EqNu" ContID="Solver"/>
   </InternalOutputs>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="tNu">
     <Link ElementID="MainPhase" ContID="Nu" Informational="False"/>
     <Link ElementID="Model" ContID="Control" Informational="True"/>
    </Contact>
    <Contact ID="NuPhase">
     <Link ElementID="MainPhase" ContID="Define" Informational="False"/>
    </Contact>
    <Contact ID="KtBound">
     <Link ElementID="B_Kt" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="EtBound">
     <Link ElementID="B_Et" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="KtPhase">
     <Link ElementID="MainPhase" ContID="Define" Informational="False"/>
    </Contact>
    <Contact ID="EtPhase">
     <Link ElementID="MainPhase" ContID="Define" Informational="False"/>
    </Contact>
    <Contact ID="NuBound">
     <Link ElementID="B_Nu" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="KtSolve">
     <Link ElementID="Solver" ContID="Eqtn" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
    <Contact ID="EtSolve">
     <Link ElementID="Solver" ContID="Eqtn" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
    <Contact ID="NuSolve">
     <Link ElementID="Solver" ContID="Eqtn" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Var" ParentID="K_E_With_GbT" ID="Nu" Permanent="True">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="393" Top="0"/>
   <Parameters NumItems="4">
    <Parameter ID="Init" Indent="0">double KT = _ZeroKt(i,x,y,z,Map);
double ET = _ZeroEt(i,x,y,z,Map);

Result = 0.0845*KT*KT/ET;
</Parameter>
    <Parameter ID="Restrict" Indent="0">Positive</Parameter>
    <Parameter ID="FBase" Indent="0">nu</Parameter>
    <Parameter ID="Desc" Indent="0">Турбулентная вязкость</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="K_E_With_GbT_EqNu" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="1">565,27</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="K_E_With_GbT" ID="K_E_With_GbT_K_Kt" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="561" Top="140"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double dUxdx = Split{0.0,dFdx(Ux)};
double dUydy = Split{0.0,dFdy(Uy)};
double dUzdz = Split{0.0,dFdz(Uz)};

double dUxdy = Split{0.0,dFdy(Ux)};
double dUydz = Split{0.0,dFdz(Uy)};
double dUzdx = Split{0.0,dFdx(Uz)};

double dUxdz = Split{0.0,dFdz(Ux)};
double dUydx = Split{0.0,dFdx(Uy)};
double dUzdy = Split{0.0,dFdy(Uz)};

double SSS2 =  2*(dUxdx*dUxdx+dUydy*dUydy+dUzdz*dUzdz)+
               (dUxdy+dUydx)*(dUxdy+dUydx)+
               (dUxdz+dUzdx)*(dUxdz+dUzdx)+
               (dUydz+dUzdy)*(dUydz+dUzdy);
double DDD =  Nu*SSS2;
</Parameter>
    <Parameter ID="Expression" Indent="0">Result = Split{0.0,DDD-Et-@BT*9.81*Nu/0.7194*dFdz(T)};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="K_E_With_GbT_EqKt" ContID="K" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="K_E_With_GbT" ID="K_E_With_GbT_K_Nu" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="548" Top="38"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0"></Parameter>
    <Parameter ID="Expression" Indent="0">0.0845 * Kt * Kt/Et;</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="K_E_With_GbT_EqNu" ContID="K" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_DynEquation" ParentID="K_E_With_GbT" ID="K_E_With_GbT_EqKt" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="679" Top="99"/>
   <Parameters NumItems="3">
    <Parameter ID="Handler" Indent="0">NULL</Parameter>
    <Parameter ID="NuMol" Indent="0">@D</Parameter>
    <Parameter ID="Kappa" Indent="0">1.0/0.7194</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="Kt" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="K_E_With_GbT_K_Kt" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks/>
  </Element>
  <Element ClassID="clsE_DynEquation" ParentID="K_E_With_GbT" ID="K_E_With_GbT_EqEt" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="681" Top="203"/>
   <Parameters NumItems="3">
    <Parameter ID="Handler" Indent="0">NULL</Parameter>
    <Parameter ID="NuMol" Indent="0">@D</Parameter>
    <Parameter ID="Kappa" Indent="0">1.0/0.7194</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="Et" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="K_E_With_GbT_K_Et" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="Bound">
     <Link ElementID="K_E_With_GbT_B_Et" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks/>
  </Element>
  <Element ClassID="clsE_Var" ParentID="K_E_With_GbT" ID="Kt" Permanent="True">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="394" Top="73"/>
   <Parameters NumItems="4">
    <Parameter ID="Init" Indent="0">double KScale = 0.208816;
double Z0 = 0.05;
double ZZ = z==0 &amp;&amp; _Z[0]==0.0 ? Z0 : (_Z[z]+_Z[z-1])*0.5+Z0;

Result = KScale*KScale*(1.09680767+(-0.008122677347+(0.0002099331724+(-0.000002208352551+(0.00000000906293221+(-9.749368416E-12+(-1.187063604E-14)*ZZ)*ZZ)*ZZ)*ZZ)*ZZ)*ZZ);
</Parameter>
    <Parameter ID="Restrict" Indent="0">Positive</Parameter>
    <Parameter ID="FBase" Indent="0">k</Parameter>
    <Parameter ID="Desc" Indent="0">Энергия пульсаций</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="K_E_With_GbT_EqKt" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="1">552,124</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Var" ParentID="K_E_With_GbT" ID="Et" Permanent="True">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="393" Top="145"/>
   <Parameters NumItems="4">
    <Parameter ID="Init" Indent="0">double KScale = 0.208816;
double Z0 = 0.05;
double ZZ = z==0 &amp;&amp; _Z[0]==0.0 ? Z0 : (_Z[z]+_Z[z-1])*0.5+Z0;

Result = KScale*KScale*KScale*0.3644/ZZ;
</Parameter>
    <Parameter ID="Restrict" Indent="0">Positive</Parameter>
    <Parameter ID="FBase" Indent="0">e</Parameter>
    <Parameter ID="Desc" Indent="0">Скорость диссипации</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="K_E_With_GbT_EqEt" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="K_E_With_GbT" ID="K_E_With_GbT_K_Et" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="563" Top="239"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double dUxdx = Split{0.0,dFdx(Ux)};
double dUydy = Split{0.0,dFdy(Uy)};
double dUzdz = Split{0.0,dFdz(Uz)};

double dUxdy = Split{0.0,dFdy(Ux)};
double dUydz = Split{0.0,dFdz(Uy)};
double dUzdx = Split{0.0,dFdx(Uz)};

double dUxdz = Split{0.0,dFdz(Ux)};
double dUydx = Split{0.0,dFdx(Uy)};
double dUzdy = Split{0.0,dFdy(Uz)};

double SSS2 =  2*(dUxdx*dUxdx+dUydy*dUydy+dUzdz*dUzdz)+
               (dUxdy+dUydx)*(dUxdy+dUydx)+
               (dUxdz+dUzdx)*(dUxdz+dUzdx)+
               (dUydz+dUzdy)*(dUydz+dUzdy);
double DDD =  Nu*SSS2;
double RNG  = sqrt(SSS2)*Kt/Et;
double RNG3 = RNG*RNG*RNG;
</Parameter>
    <Parameter ID="Expression" Indent="0">Split{0.0, (1.42*DDD-(1.68+0.0845*RNG3*(1-RNG/4.38)/(1+0.012*RNG3))*Et)*Et/Kt};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="K_E_With_GbT_EqEt" ContID="K" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_DirectEquation" ParentID="K_E_With_GbT" ID="K_E_With_GbT_EqNu" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="680" Top="2"/>
   <Parameters NumItems="1">
    <Parameter ID="Handler" Indent="0">DirectSolver</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="Nu" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="K_E_With_GbT_K_Nu" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="Bound">
     <Link ElementID="K_E_With_GbT_B_Nu" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks/>
  </Element>
  <Element ClassID="clsE_Function" ParentID="K_E_With_GbT" ID="K_E_With_GbT_B_Et" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="562" Top="292"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0"></Parameter>
    <Parameter ID="Expression" Indent="0">if (IsCond(Et,A))
                    {
                     if (IsForw)   _fw(Et) = pow(0.0845,0.75)*pow(_fw(Kt),1.5)/0.41/HY[YM];
                     if (IsBack)   _bw(Et) = pow(0.0845,0.75)*pow(_bw(Kt),1.5)/0.41/HY[y];
                     if (IsBottom) _bt(Et) = pow(0.0845,0.75)*pow(_bt(Kt),1.5)/0.41/HZ[z];
                     if (IsTop)    _tp(Et) = pow(0.0845,0.75)*pow(_tp(Kt),1.5)/0.41/HZ_ZM;
                     if (IsLeft)   _lf(Et) = pow(0.0845,0.75)*pow(_lf(Kt),1.5)/0.41/HX[x];
                     if (IsRight)  _rg(Et) = pow(0.0845,0.75)*pow(_rg(Kt),1.5)/0.41/HX[XM];
                    }
</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="K_E_With_GbT_EqEt" ContID="Bound" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="K_E_With_GbT" ID="K_E_With_GbT_B_Nu" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="556" Top="78"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0"></Parameter>
    <Parameter ID="Expression" Indent="0">if (IsCond(Nu,A))
                    {
                     if (IsForw)   _fw(Nu) = 0.0845*pow(_fw(Kt),2)/_fw(Et);
                     if (IsBack)   _bw(Nu) = 0.0845*pow(_bw(Kt),2)/_bw(Et);
                     if (IsBottom) _bt(Nu) = 0.0845*pow(_bt(Kt),2)/_bt(Et);
                     if (IsTop)    _tp(Nu) = 0.0845*pow(_tp(Kt),2)/_tp(Et);
                     if (IsLeft)   _lf(Nu) = 0.0845*pow(_lf(Kt),2)/_lf(Et);
                     if (IsRight)  _rg(Nu) = 0.0845*pow(_rg(Kt),2)/_rg(Et);
                    }
</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="K_E_With_GbT_EqNu" ContID="Bound" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="B_Kt" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="439" Top="62"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double KScale = 0.208816;
double Z0 = 0.05;
double ZZ = z==0 &amp;&amp; _Z[0]==0.0 ? Z0 : (_Z[z]+_Z[z-1])*0.5+Z0;
double NuK = KScale*KScale*(1.09680767+(-0.008122677347+(0.0002099331724+(-0.000002208352551+(0.00000000906293221+(-9.749368416E-12+(-1.187063604E-14)*ZZ)*ZZ)*ZZ)*ZZ)*ZZ)*ZZ);
double NuE = KScale*KScale*KScale*0.3644/ZZ;
</Parameter>
    <Parameter ID="Expression" Indent="0">Result =  IsCond(Nu,B) ? NuK : Kt;</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="K_E_With_GbT" ContID="KtBound" Color="#FF8080" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="B_Et" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="392" Top="102"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double KScale = 0.208816;
double Z0 = 0.05;
double ZZ = z==0 &amp;&amp; _Z[0]==0.0 ? Z0 : (_Z[z]+_Z[z-1])*0.5+Z0;
double NuK = KScale*KScale*(1.09680767+(-0.008122677347+(0.0002099331724+(-0.000002208352551+(0.00000000906293221+(-9.749368416E-12+(-1.187063604E-14)*ZZ)*ZZ)*ZZ)*ZZ)*ZZ)*ZZ);
double NuE = KScale*KScale*KScale*0.3644/ZZ;
</Parameter>
    <Parameter ID="Expression" Indent="0">Result =  IsCond(Nu,B) ? NuE : Et;</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="K_E_With_GbT" ContID="EtBound" Color="#FF8080" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="B_Nu" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="460" Top="162"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double KScale = 0.208816;
double Z0 = 0.05;
double ZZ = z==0 &amp;&amp; _Z[0]==0.0 ? Z0 : (_Z[z]+_Z[z-1])*0.5+Z0;
double NuK = KScale*KScale*(1.09680767+(-0.008122677347+(0.0002099331724+(-0.000002208352551+(0.00000000906293221+(-9.749368416E-12+(-1.187063604E-14)*ZZ)*ZZ)*ZZ)*ZZ)*ZZ)*ZZ);
double NuE = KScale*KScale*KScale*0.3644/ZZ;
</Parameter>
    <Parameter ID="Expression" Indent="0">Result =  IsCond(Nu,B) ? 0.0845*NuK*NuK/NuE : Nu;</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="K_E_With_GbT" ContID="NuBound" Color="#FF8080" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="B_Ux" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="365" Top="251"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double KScale = 0.208816;
double Uref = KScale*0.5263;
double Z0 = 0.05;
double ZZ = z==0 &amp;&amp; _Z[0]==0.0 ? Z0 : (_Z[z]+_Z[z-1])*0.5+Z0;
double K0 = Uref*ZZ;
double K1 = log(ZZ/Z0);
</Parameter>
    <Parameter ID="Expression" Indent="0">Result =  IsCond(Ux,B) ?
                       2.5*@Kx*Uref*K1 :
                       Ux;
</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="P_U" ContID="BoundUx" Color="#FF8080" Informational="False">
      <Points NumItems="1">461,324</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="B_Uy" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="365" Top="292"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double KScale = 0.208816;
double Uref = KScale*0.5263;
double Z0 = 0.05;
double ZZ = z==0 &amp;&amp; _Z[0]==0.0 ? Z0 : (_Z[z]+_Z[z-1])*0.5+Z0;
double K0 = Uref*ZZ;
double K1 = log(ZZ/Z0);
</Parameter>
    <Parameter ID="Expression" Indent="0">Result =  IsCond(Uy,B) ?
                        2.5*@Ky*Uref*K1 :
                        Uy;
</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="P_U" ContID="BoundUy" Color="#FF8080" Informational="False">
      <Points NumItems="1">454,341</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Modification" ParentID="" ID="EqSO2" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="567" Top="888"/>
   <Parameters NumItems="0"/>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="SO2" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="K_SO2" ContID="Val" Informational="False"/>
     <Link ElementID="K_Drops_SO2" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Solver">
     <Link ElementID="Solver" ContID="Modify" Color="clBlue" Informational="False">
      <Points NumItems="1">939,939</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Substance" ParentID="" ID="SO2" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="383" Top="900"/>
   <Parameters NumItems="1">
    <Parameter ID="Substance" Indent="0">SO2</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Phase">
     <Link ElementID="MainPhase" ContID="Define" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="EqSO2" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="1">481,913</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="K_SO2" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="483" Top="922"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0"></Parameter>
    <Parameter ID="Expression" Indent="0">(_Z[0]==0.0 &amp;&amp; z==1 ? 1.114E-14 : 0.0);</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqSO2" ContID="K" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Var" ParentID="" ID="FUV" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="366" Top="988"/>
   <Parameters NumItems="4">
    <Parameter ID="Init" Indent="0">0</Parameter>
    <Parameter ID="Restrict" Indent="0">Any</Parameter>
    <Parameter ID="FBase" Indent="0">fuv</Parameter>
    <Parameter ID="Desc" Indent="0">Интенсивность UV-прямого излучения</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Phase">
     <Link ElementID="MainPhase" ContID="Define" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="EqFUV" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="1">533,1025</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Var" ParentID="" ID="UV" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="383" Top="1088"/>
   <Parameters NumItems="4">
    <Parameter ID="Init" Indent="0">0</Parameter>
    <Parameter ID="Restrict" Indent="0">Positive</Parameter>
    <Parameter ID="FBase" Indent="0">uv</Parameter>
    <Parameter ID="Desc" Indent="0">Интенсивность UV-диффузного излучения</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Phase">
     <Link ElementID="MainPhase" ContID="Define" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="EqUV" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_SolarEquation" ParentID="" ID="EqFUV" Permanent="False">
   <Show Class="True" Name="True" Image="False"/>
   <Position Left="619" Top="983"/>
   <Parameters NumItems="3">
    <Parameter ID="Handler" Indent="0">SolarSolver</Parameter>
    <Parameter ID="NuMol" Indent="0">0.0</Parameter>
    <Parameter ID="Kappa" Indent="0">0.0</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="FUV" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="K_FUV" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="S">
     <Link ElementID="S_FUV" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Solver">
     <Link ElementID="Solver" ContID="Eqtn" Color="clBlack" Informational="False">
      <Points NumItems="1">771,1051</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_PoissonEquation" ParentID="" ID="EqUV" Permanent="False">
   <Show Class="True" Name="True" Image="False"/>
   <Position Left="567" Top="1092"/>
   <Parameters NumItems="3">
    <Parameter ID="Handler" Indent="0">PoissonSolver</Parameter>
    <Parameter ID="NuMol" Indent="0">0.0</Parameter>
    <Parameter ID="Kappa" Indent="0">0.0</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="UV" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="K_UV" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="Bound">
     <Link ElementID="B_UV" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="S">
     <Link ElementID="S_UV" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Solver">
     <Link ElementID="Solver" ContID="Eqtn" Color="clBlack" Informational="False">
      <Points NumItems="1">761,1160</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="K_UV" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="365" Top="1200"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double Pi = 3.1415926535897932;
double ukAlbAsm = ukAlbedo*ukAsymm;
double utAlpha = ueBeta*(1-ukAlbedo);
double utBeta = ueBeta*(1-ukAlbAsm);
double u_Ft = 3.0*ueBeta*ukAlbedo/4.0/Pi;
double uFt = u_Ft*FUV;
</Parameter>
    <Parameter ID="Expression" Indent="0">Split{0.0,-uFt*utBeta};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqUV" ContID="K" Color="clBlack" Informational="False">
      <Points NumItems="2">441,1225,441,1151</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="S_UV" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="447" Top="1201"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double Pi = 3.1415926535897932;
double ukAlbAsm = ukAlbedo*ukAsymm;
double utAlpha = ueBeta*(1-ukAlbedo);
double utBeta = ueBeta*(1-ukAlbAsm);
double u_Ft = 3.0*ueBeta*ukAlbedo/4.0/Pi;
double uFt = u_Ft*FUV;
</Parameter>
    <Parameter ID="Expression" Indent="0">Split{0.0,3.0*utAlpha*utBeta};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqUV" ContID="S" Color="clYellow" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="B_UV" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="453" Top="1156"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double uk1 = 2.0/3.0/utBeta;
double uk1a = uk1*(1+@SurfaceAlbedo);
double uFluxPi = @uDiffuseFlux/Pi;
</Parameter>
    <Parameter ID="Expression" Indent="6">if (IsClosed(UV))
        {
         if (IsForw)   _fw(UV) = (uk1a*UV[back]+HY[y-1]*SolarY*_fw(FUV)*@SurfaceAlbedo/Pi)/(uk1a+HY[y-1]*(1-@SurfaceAlbedo));
         if (IsBack)   _bw(UV) = (uk1a*UV[forw]-HY[y]*SolarY*  _bw(FUV)*@SurfaceAlbedo/Pi)/(uk1a+HY[y]*(1-@SurfaceAlbedo));
         if (IsBottom) _bt(UV) = (uk1a*UV[up]-HZ[z]*SolarZ*  _bt(FUV)*@SurfaceAlbedo/Pi)/(uk1a+HZ[z]*(1-@SurfaceAlbedo));
         if (IsTop)    _tp(UV) = (uk1a*UV[down]+HZ_ZM*SolarZ*  _tp(FUV)*@SurfaceAlbedo/Pi)/(uk1a+HZ_ZM*(1-@SurfaceAlbedo));
         if (IsLeft)   _lf(UV) = (uk1a*UV[right]-HX[x]*SolarX*  _lf(FUV)*@SurfaceAlbedo/Pi)/(uk1a+HX[x]*(1-@SurfaceAlbedo));
         if (IsRight)  _rg(UV) = (uk1a*UV[left]+HX[x-1]*SolarX*_rg(FUV)*@SurfaceAlbedo/Pi)/(uk1a+HX[x-1]*(1-@SurfaceAlbedo));
        }
      else
        {
         if (IsForw)   _fw(UV) = (uk1*UV[back]+HY[y-1]*uFluxPi)/(uk1+HY[y-1]);
         if (IsBack)   _bw(UV) = (uk1*UV[forw]+HY[y]*uFluxPi)/(uk1+HY[y]);
         if (IsBottom) _bt(UV) = (uk1*UV[up]+HZ[z]*uFluxPi)/(uk1+HZ[z]);
         if (IsTop)    _tp(UV) = (uk1*UV[down]+HZ_ZM*uFluxPi)/(uk1+HZ_ZM);
         if (IsLeft)   _lf(UV) = (uk1*UV[right]+HX[x]*uFluxPi)/(uk1+HX[x]);
         if (IsRight)  _rg(UV) = (uk1*UV[left]+HX[x-1]*uFluxPi)/(uk1+HX[x-1]);
        }
</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqUV" ContID="Bound" Color="#FF8080" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="K_FUV" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="416" Top="1047"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0"></Parameter>
    <Parameter ID="Expression" Indent="0">ueBeta;</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqFUV" ContID="K" Color="clBlack" Informational="False">
      <Points NumItems="1">506,1042</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="S_FUV" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="518" Top="1051"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0"></Parameter>
    <Parameter ID="Expression" Indent="0">@uSolarIntensity;</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqFUV" ContID="S" Color="clYellow" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_SolarEquation" ParentID="" ID="EqF0" Permanent="False">
   <Show Class="True" Name="True" Image="False"/>
   <Position Left="619" Top="1202"/>
   <Parameters NumItems="3">
    <Parameter ID="Handler" Indent="0">SolarSolver</Parameter>
    <Parameter ID="NuMol" Indent="0">0.0</Parameter>
    <Parameter ID="Kappa" Indent="0">0.0</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="F0" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="K_F0" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="S">
     <Link ElementID="S_F0" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Solver">
     <Link ElementID="Solver" ContID="Eqtn" Color="clBlack" Informational="False">
      <Points NumItems="1">752,1270</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Var" ParentID="" ID="F0" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="385" Top="1241"/>
   <Parameters NumItems="4">
    <Parameter ID="Init" Indent="0">0</Parameter>
    <Parameter ID="Restrict" Indent="0">Any</Parameter>
    <Parameter ID="FBase" Indent="0">f0</Parameter>
    <Parameter ID="Desc" Indent="0">Интенсивность VIS-прямого излучения</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Phase">
     <Link ElementID="MainPhase" ContID="Define" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="EqF0" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="1">522,1244</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="K_F0" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="526" Top="1257"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0"></Parameter>
    <Parameter ID="Expression" Indent="0">eBeta;</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqF0" ContID="K" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="S_F0" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="521" Top="1300"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0"></Parameter>
    <Parameter ID="Expression" Indent="0">@SolarIntensity;</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqF0" ContID="S" Color="clYellow" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_PoissonEquation" ParentID="" ID="EqI" Permanent="False">
   <Show Class="True" Name="True" Image="False"/>
   <Position Left="619" Top="1310"/>
   <Parameters NumItems="3">
    <Parameter ID="Handler" Indent="0">PoissonSolver</Parameter>
    <Parameter ID="NuMol" Indent="0">0.0</Parameter>
    <Parameter ID="Kappa" Indent="0">0.0</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="I" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="K_I" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="Bound">
     <Link ElementID="B_I" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="S">
     <Link ElementID="S_I" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Solver">
     <Link ElementID="Solver" ContID="Eqtn" Color="clBlack" Informational="False">
      <Points NumItems="1">740,1378</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="K_I" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="385" Top="1359"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double Pi = 3.1415926535897932;
double kAlbAsm = kAlbedo*kAsymm;
double tAlpha = eBeta*(1-kAlbedo);
double tBeta = eBeta*(1-kAlbAsm);
double _Ft = 3.0*eBeta*kAlbedo/4.0/Pi;
double Ft = _Ft*F0;
</Parameter>
    <Parameter ID="Expression" Indent="0">Split{0.0,-Ft*tBeta};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqI" ContID="K" Color="clBlack" Informational="False">
      <Points NumItems="2">471,1362,569,1362</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="B_I" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="477" Top="1368"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double k1 = 2.0/3.0/tBeta;
double k1a = k1*(1+@SurfaceAlbedo);
double FluxPi = @DiffuseFlux/Pi;
</Parameter>
    <Parameter ID="Expression" Indent="6">if (IsClosed(I))
        {
         if (IsForw)   _fw(I) = (k1a*I[back]+HY[y-1]*SolarY*_fw(F0)*@SurfaceAlbedo/Pi)/(k1a+HY[y-1]*(1-@SurfaceAlbedo));
         if (IsBack)   _bw(I) = (k1a*I[forw]-HY[y]*SolarY*  _bw(F0)*@SurfaceAlbedo/Pi)/(k1a+HY[y]*(1-@SurfaceAlbedo));
         if (IsBottom) _bt(I) = (k1a*I[up]-HZ[z]*SolarZ*    _bt(F0)*@SurfaceAlbedo/Pi)/(k1a+HZ[z]*(1-@SurfaceAlbedo));
         if (IsTop)    _tp(I) = (k1a*I[down]+HZ_ZM*SolarZ*  _tp(F0)*@SurfaceAlbedo/Pi)/(k1a+HZ_ZM*(1-@SurfaceAlbedo));
         if (IsLeft)   _lf(I) = (k1a*I[right]-HX[x]*SolarX* _lf(F0)*@SurfaceAlbedo/Pi)/(k1a+HX[x]*(1-@SurfaceAlbedo));
         if (IsRight)  _rg(I) = (k1a*I[left]+HX[x-1]*SolarX*_rg(F0)*@SurfaceAlbedo/Pi)/(k1a+HX[x-1]*(1-@SurfaceAlbedo));
        }
      else
        {
         if (IsForw)   _fw(I) = (k1*I[back]+HY[y-1]*FluxPi)/(k1+HY[y-1]);
         if (IsBack)   _bw(I) = (k1*I[forw]+HY[y]*FluxPi)/(k1+HY[y]);
         if (IsBottom) _bt(I) = (k1*I[up]+HZ[z]*FluxPi)/(k1+HZ[z]);
         if (IsTop)    _tp(I) = (k1*I[down]+HZ_ZM*FluxPi)/(k1+HZ_ZM);
         if (IsLeft)   _lf(I) = (k1*I[right]+HX[x]*FluxPi)/(k1+HX[x]);
         if (IsRight)  _rg(I) = (k1*I[left]+HX[x-1]*FluxPi)/(k1+HX[x-1]);
        }
</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqI" ContID="Bound" Color="#FF8080" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="S_I" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="513" Top="1406"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double Pi = 3.1415926535897932;
double kAlbAsm = kAlbedo*kAsymm;
double tAlpha = eBeta*(1-kAlbedo);
double tBeta = eBeta*(1-kAlbAsm);
double _Ft = 3.0*eBeta*kAlbedo/4.0/Pi;
double Ft = _Ft*F0;
</Parameter>
    <Parameter ID="Expression" Indent="0">Split{0.0,3.0*tAlpha*tBeta};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqI" ContID="S" Color="clYellow" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Var" ParentID="" ID="I" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="385" Top="1299"/>
   <Parameters NumItems="4">
    <Parameter ID="Init" Indent="0">0</Parameter>
    <Parameter ID="Restrict" Indent="0">Positive</Parameter>
    <Parameter ID="FBase" Indent="0">i</Parameter>
    <Parameter ID="Desc" Indent="0">Интенсивность VIS-диффузного излучения</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Phase">
     <Link ElementID="MainPhase" ContID="Define" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="EqI" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_SolarEquation" ParentID="" ID="EqFIR" Permanent="False">
   <Show Class="True" Name="True" Image="False"/>
   <Position Left="618" Top="1420"/>
   <Parameters NumItems="3">
    <Parameter ID="Handler" Indent="0">SolarSolver</Parameter>
    <Parameter ID="NuMol" Indent="0">0.0</Parameter>
    <Parameter ID="Kappa" Indent="0">0.0</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="FIR" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="K_FIR" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="S">
     <Link ElementID="S_FIR" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Solver">
     <Link ElementID="Solver" ContID="Eqtn" Color="clBlack" Informational="False">
      <Points NumItems="1">731,1488</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_PoissonEquation" ParentID="" ID="EqIR" Permanent="False">
   <Show Class="True" Name="True" Image="False"/>
   <Position Left="619" Top="1530"/>
   <Parameters NumItems="3">
    <Parameter ID="Handler" Indent="0">PoissonSolver</Parameter>
    <Parameter ID="NuMol" Indent="0">0.0</Parameter>
    <Parameter ID="Kappa" Indent="0">0.0</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="IR" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="K_IR" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="Bound">
     <Link ElementID="B_IR" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="S">
     <Link ElementID="S_IR" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Solver">
     <Link ElementID="Solver" ContID="Eqtn" Color="clBlack" Informational="False">
      <Points NumItems="1">737,1598</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Var" ParentID="" ID="FIR" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="384" Top="1412"/>
   <Parameters NumItems="4">
    <Parameter ID="Init" Indent="0">0</Parameter>
    <Parameter ID="Restrict" Indent="0">Any</Parameter>
    <Parameter ID="FBase" Indent="0">fir</Parameter>
    <Parameter ID="Desc" Indent="0">Интенсивность IR-прямого излучения</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Phase">
     <Link ElementID="MainPhase" ContID="Define" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="EqFIR" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="1">549,1454</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="K_FIR" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="502" Top="1462"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0"></Parameter>
    <Parameter ID="Expression" Indent="0">reBeta;</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqFIR" ContID="K" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="S_FIR" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="525" Top="1504"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0"></Parameter>
    <Parameter ID="Expression" Indent="0">@rSolarIntensity;</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqFIR" ContID="S" Color="clYellow" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Var" ParentID="" ID="IR" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="383" Top="1482"/>
   <Parameters NumItems="4">
    <Parameter ID="Init" Indent="0">0</Parameter>
    <Parameter ID="Restrict" Indent="0">Positive</Parameter>
    <Parameter ID="FBase" Indent="0">ir</Parameter>
    <Parameter ID="Desc" Indent="0">Интенсивность IR-диффузного излучения</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Phase">
     <Link ElementID="MainPhase" ContID="Define" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="EqIR" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="2">510,1524,510,1572</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="K_IR" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="384" Top="1538"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double Pi = 3.1415926535897932;
double rkAlbAsm = rkAlbedo*rkAsymm;
double rtAlpha = reBeta*(1-rkAlbedo);
double rtBeta = reBeta*(1-rkAlbAsm);
double r_Ft = 3.0*reBeta*rkAlbedo/4.0/Pi;
double rFt = r_Ft*FIR;
</Parameter>
    <Parameter ID="Expression" Indent="0">Split{0.0,-rFt*rtBeta};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqIR" ContID="K" Color="clBlack" Informational="False">
      <Points NumItems="2">483,1563,483,1589</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="S_IR" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="521" Top="1615"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double Pi = 3.1415926535897932;
double rkAlbAsm = rkAlbedo*rkAsymm;
double rtAlpha = reBeta*(1-rkAlbedo);
double rtBeta = reBeta*(1-rkAlbAsm);
double r_Ft = 3.0*reBeta*rkAlbedo/4.0/Pi;
double rFt = r_Ft*FIR;
</Parameter>
    <Parameter ID="Expression" Indent="0">Split{0.0,3.0*rtAlpha*rtBeta};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqIR" ContID="S" Color="clYellow" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="B_IR" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="398" Top="1581"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double rk1 = 2.0/3.0/rtBeta;
double rk1a = rk1*(1+@SurfaceAlbedo);
double rFluxPi = @rDiffuseFlux/Pi;
</Parameter>
    <Parameter ID="Expression" Indent="6">if (IsClosed(IR))
        {
         if (IsForw)   _fw(IR) = (rk1a*IR[back]+HY[y-1]*SolarY*_fw(FIR)*@SurfaceAlbedo/Pi)/(rk1a+HY[y-1]*(1-@SurfaceAlbedo));
         if (IsBack)   _bw(IR) = (rk1a*IR[forw]-HY[y]*SolarY*  _bw(FIR)*@SurfaceAlbedo/Pi)/(rk1a+HY[y]*(1-@SurfaceAlbedo));
         if (IsBottom) _bt(IR) = (rk1a*IR[up]-HZ[z]*SolarZ*    _bt(FIR)*@SurfaceAlbedo/Pi)/(rk1a+HZ[z]*(1-@SurfaceAlbedo));
         if (IsTop)    _tp(IR) = (rk1a*IR[down]+HZ_ZM*SolarZ*  _tp(FIR)*@SurfaceAlbedo/Pi)/(rk1a+HZ_ZM*(1-@SurfaceAlbedo));
         if (IsLeft)   _lf(IR) = (rk1a*IR[right]-HX[x]*SolarX* _lf(FIR)*@SurfaceAlbedo/Pi)/(rk1a+HX[x]*(1-@SurfaceAlbedo));
         if (IsRight)  _rg(IR) = (rk1a*IR[left]+HX[x-1]*SolarX*_rg(FIR)*@SurfaceAlbedo/Pi)/(rk1a+HX[x-1]*(1-@SurfaceAlbedo));
        }
      else
        {
         if (IsForw)   _fw(IR) = (rk1*IR[back]+HY[y-1]*rFluxPi)/(rk1+HY[y-1]);
         if (IsBack)   _bw(IR) = (rk1*IR[forw]+HY[y]*rFluxPi)/(rk1+HY[y]);
         if (IsBottom) _bt(IR) = (rk1*IR[up]+HZ[z]*rFluxPi)/(rk1+HZ[z]);
         if (IsTop)    _tp(IR) = (rk1*IR[down]+HZ_ZM*rFluxPi)/(rk1+HZ_ZM);
         if (IsLeft)   _lf(IR) = (rk1*IR[right]+HX[x]*rFluxPi)/(rk1+HX[x]);
         if (IsRight)  _rg(IR) = (rk1*IR[left]+HX[x-1]*rFluxPi)/(rk1+HX[x-1]);
        }
</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqIR" ContID="Bound" Color="#FF8080" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_PoissonEquation" ParentID="" ID="EqIRt" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="618" Top="1641"/>
   <Parameters NumItems="3">
    <Parameter ID="Handler" Indent="0">PoissonSolver</Parameter>
    <Parameter ID="NuMol" Indent="0">0.0</Parameter>
    <Parameter ID="Kappa" Indent="0">0.0</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="IRt" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="K_IRt" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="Bound">
     <Link ElementID="B_IRt" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="S">
     <Link ElementID="S_IRt" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Solver">
     <Link ElementID="Solver" ContID="Eqtn" Color="clBlack" Informational="False">
      <Points NumItems="1">736,1692</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Var" ParentID="" ID="IRt" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="383" Top="1624"/>
   <Parameters NumItems="4">
    <Parameter ID="Init" Indent="0">0</Parameter>
    <Parameter ID="Restrict" Indent="0">Positive</Parameter>
    <Parameter ID="FBase" Indent="0">irt</Parameter>
    <Parameter ID="Desc" Indent="0">Интенсивность IR-теплового излучения</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Phase">
     <Link ElementID="MainPhase" ContID="Define" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="EqIRt" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="K_IRt" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="502" Top="1673"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double tkAlbAsm = tkAlbedo*tkAsymm;
double ttAlpha = teBeta*(1-tkAlbedo);
double ttBeta = teBeta*(1-tkAlbAsm);
double tPlanck = (@[]IntPlanck[0]+TK*(@IntPlanck[1]+TK*(@IntPlanck[2]+TK*@IntPlanck[3])));
double tFt = 3.0*ttAlpha*tPlanck;
</Parameter>
    <Parameter ID="Expression" Indent="0">Split{0.0,-tFt*ttBeta};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqIRt" ContID="K" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="B_IRt" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="407" Top="1685"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double tk1 = 2.0/3.0/ttBeta;
double tk1a = tk1*(2.0-@SurfaceEmissivity);
double tFluxPi = @tDiffuseFlux/Pi;
</Parameter>
    <Parameter ID="Expression" Indent="6">if (IsClosed(IRt))
        {
         if (IsForw)   _fw(IRt) = (tk1a*IRt[back]+HY[y-1]*@SurfaceEmissivity*(@[]IntPlanck[0]+(273.15+_fw(T))*(@IntPlanck[1]+(273.15+_fw(T))*(@IntPlanck[2]+(273.15+_fw(T))*@IntPlanck[3])))/Pi)/(tk1a+HY[y-1]*@SurfaceEmissivity);
         if (IsBack)   _bw(IRt) = (tk1a*IRt[forw]+HY[y]*  @SurfaceEmissivity*(@[]IntPlanck[0]+(273.15+_bw(T))*(@IntPlanck[1]+(273.15+_bw(T))*(@IntPlanck[2]+(273.15+_bw(T))*@IntPlanck[3])))/Pi)/(tk1a+HY[y]*@SurfaceEmissivity);
         if (IsBottom) _bt(IRt) = (tk1a*IRt[up]+HZ[z]*    @SurfaceEmissivity*(@[]IntPlanck[0]+(273.15+_bt(T))*(@IntPlanck[1]+(273.15+_bt(T))*(@IntPlanck[2]+(273.15+_bt(T))*@IntPlanck[3])))/Pi)/(tk1a+HZ[z]*@SurfaceEmissivity);
         if (IsTop)    _tp(IRt) = (tk1a*IRt[down]+HZ_ZM*  @SurfaceEmissivity*(@[]IntPlanck[0]+(273.15+_tp(T))*(@IntPlanck[1]+(273.15+_tp(T))*(@IntPlanck[2]+(273.15+_tp(T))*@IntPlanck[3])))/Pi)/(tk1a+HZ_ZM*@SurfaceEmissivity);
         if (IsLeft)   _lf(IRt) = (tk1a*IRt[right]+HX[x]* @SurfaceEmissivity*(@[]IntPlanck[0]+(273.15+_lf(T))*(@IntPlanck[1]+(273.15+_lf(T))*(@IntPlanck[2]+(273.15+_lf(T))*@IntPlanck[3])))/Pi)/(tk1a+HX[x]*@SurfaceEmissivity);
         if (IsRight)  _rg(IRt) = (tk1a*IRt[left]+HX[x-1]*@SurfaceEmissivity*(@[]IntPlanck[0]+(273.15+_rg(T))*(@IntPlanck[1]+(273.15+_rg(T))*(@IntPlanck[2]+(273.15+_rg(T))*@IntPlanck[3])))/Pi)/(tk1a+HX[x-1]*@SurfaceEmissivity);
        }
      else
        {
         if (IsForw)   _fw(IRt) = (tk1*IRt[back]+HY[y-1]*tFluxPi)/(tk1+HY[y-1]);
         if (IsBack)   _bw(IRt) = (tk1*IRt[forw]+HY[y]*tFluxPi)/(tk1+HY[y]);
         if (IsBottom) _bt(IRt) = (tk1*IRt[up]+HZ[z]*tFluxPi)/(tk1+HZ[z]);
         if (IsTop)    _tp(IRt) = (tk1*IRt[down]+HZ_ZM*tFluxPi)/(tk1+HZ_ZM);
         if (IsLeft)   _lf(IRt) = (tk1*IRt[right]+HX[x]*tFluxPi)/(tk1+HX[x]);
         if (IsRight)  _rg(IRt) = (tk1*IRt[left]+HX[x-1]*tFluxPi)/(tk1+HX[x-1]);
        }
</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqIRt" ContID="Bound" Color="#FF8080" Informational="False">
      <Points NumItems="2">495,1716,577,1716</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="S_IRt" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="502" Top="1724"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double tkAlbAsm = tkAlbedo*tkAsymm;
double ttAlpha = teBeta*(1-tkAlbedo);
double ttBeta = teBeta*(1-tkAlbAsm);
double tPlanck = (@[]IntPlanck[0]+TK*(@IntPlanck[1]+TK*(@IntPlanck[2]+TK*@IntPlanck[3])));
double tFt = 3.0*ttAlpha*tPlanck;
</Parameter>
    <Parameter ID="Expression" Indent="0">Split{0.0,3.0*ttAlpha*ttBeta};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqIRt" ContID="S" Color="clYellow" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Var" ParentID="" ID="T" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="734" Top="2"/>
   <Parameters NumItems="4">
    <Parameter ID="Init" Indent="0">@ZeroT - _Z[z]*3.0/44.0</Parameter>
    <Parameter ID="Restrict" Indent="0">Any</Parameter>
    <Parameter ID="FBase" Indent="0">t</Parameter>
    <Parameter ID="Desc" Indent="0">Температура (градусы Цельсия)</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="PhasePrm">
     <Link ElementID="MainPhase" ContID="T" Informational="False"/>
    </Contact>
    <Contact ID="Phase">
     <Link ElementID="MainPhase" ContID="Define" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="EqT" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_DynEquation" ParentID="" ID="EqT" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="929" Top="59"/>
   <Parameters NumItems="3">
    <Parameter ID="Handler" Indent="0">NULL</Parameter>
    <Parameter ID="NuMol" Indent="0">1.978E-5</Parameter>
    <Parameter ID="Kappa" Indent="0">1.393</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="T" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="K_T" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="Bound">
     <Link ElementID="B_T" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Solver">
     <Link ElementID="Solver" ContID="Eqtn" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="K_T" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="777" Top="76"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double TK = 273.15+T;
double RO0 = 352.984/TK;
double CC0 = 1.4*(718+0.1167*RO0);
</Parameter>
    <Parameter ID="Expression" Indent="0">Split{0.0,(tAlpha*(4.0*Pi*I+F0)+rtAlpha*(4.0*Pi*IR+FIR)+4.0*Pi*(ttAlpha*IRt-tFt/3.0))/RO0/CC0};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqT" ContID="K" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="B_T" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="800" Top="124"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="3"></Parameter>
    <Parameter ID="Expression" Indent="3">if (IsClosed(T) &amp;&amp; SlowMode)
      {
       if (IsForw)
          {
           double TKK = 273.15+_fw(T);
           double LambdaT = 1E-3*(4.39+0.071*TKK);

           _fw(T) += TAU/@SurfaceCC/@SurfaceRO*(@SurfaceLambda*(_d2Fdx2(_forw,T)  +_d2Fdz2(_forw,T))+((1-@SurfaceAlbedo)*  (Pi*(_fw(I)+_fw(IR)+_fw(UV)-k1*dFdyf(I)-rk1*dFdyf(IR)-uk1*dFdyf(UV))+(_fw(F0)+_fw(FIR)+_fw(FUV))*SolarY)+@SurfaceEmissivity*(Pi*(_fw(IRt)-tk1*dFdyf(IRt))-(@[]IntPlanck[0]+TKK*(@IntPlanck[1]+TKK*(@IntPlanck[2]+TKK*@IntPlanck[3]))))+LambdaT/HY[YM]*(T[back]-_fw(T)))/HY[YM]);
          }
       if (IsBack)
          {
           double TKK = 273.15+_bw(T);
           double LambdaT = 1E-3*(4.39+0.071*TKK);

           _bw(T) += TAU/@SurfaceCC/@SurfaceRO*(@SurfaceLambda*(_d2Fdx2(_back,T)  +_d2Fdz2(_back,T))+((1-@SurfaceAlbedo)*  (Pi*(_bw(I)+_bw(IR)+_bw(UV)+k1*dFdyb(I)+rk1*dFdyb(IR)+uk1*dFdyb(UV))-(_bw(F0)+_bw(FIR)+_bw(FUV))*SolarY)+@SurfaceEmissivity*(Pi*(_bw(IRt)+tk1*dFdyb(IRt))-(@[]IntPlanck[0]+TKK*(@IntPlanck[1]+TKK*(@IntPlanck[2]+TKK*@IntPlanck[3]))))+LambdaT/HY[y]*(T[forw]- _bw(T)))/HY[y]);
          }
       if (IsBottom)
          {
           double TKK = 273.15+_bt(T);
           double LambdaT = 1E-3*(4.39+0.071*TKK);

           _bt(T) += TAU/@SurfaceCC/@SurfaceRO*(@SurfaceLambda*(_d2Fdx2(_bottom,T)+_d2Fdy2(_bottom,T))+((1-@SurfaceAlbedo)*(Pi*(_bt(I)+_bt(IR)+_bt(UV)+k1*dFdzb(I)+rk1*dFdzb(IR)+uk1*dFdzb(UV))-(_bt(F0)+_bt(FIR)+_bt(FUV))*SolarZ)+@SurfaceEmissivity*(Pi*(_bt(IRt)+tk1*dFdzb(IRt))-(@[]IntPlanck[0]+TKK*(@IntPlanck[1]+TKK*(@IntPlanck[2]+TKK*@IntPlanck[3]))))+LambdaT/HZ[z]*(T[up]-   _bt(T)))/HZ[z]);
          }
       if (IsTop)
          {
           double TKK = 273.15+_tp(T);
           double LambdaT = 1E-3*(4.39+0.071*TKK);

           _tp(T) += TAU/@SurfaceCC/@SurfaceRO*(@SurfaceLambda*(_d2Fdx2(_top,T)   +_d2Fdy2(_top,T))+((1-@SurfaceAlbedo)*   (Pi*(_tp(I)+_tp(IR)+_tp(UV)-k1*dFdzt(I)-rk1*dFdzt(IR)-uk1*dFdzt(UV))+(_tp(F0)+_tp(FIR)+_tp(FUV))*SolarZ)+@SurfaceEmissivity*(Pi*(_tp(IRt)-tk1*dFdzt(IRt))-(@[]IntPlanck[0]+TKK*(@IntPlanck[1]+TKK*(@IntPlanck[2]+TKK*@IntPlanck[3]))))+LambdaT/HZ_ZM*(T[down]- _tp(T)))/HZ_ZM);
          }
       if (IsLeft)
          {
           double TKK = 273.15+_lf(T);
           double LambdaT = 1E-3*(4.39+0.071*TKK);

           _lf(T) += TAU/@SurfaceCC/@SurfaceRO*(@SurfaceLambda*(_d2Fdy2(_left,T)  +_d2Fdz2(_left,T))+((1-@SurfaceAlbedo)*  (Pi*(_lf(I)+_lf(IR)+_lf(UV)+k1*dFdxl(I)+rk1*dFdxl(IR)+uk1*dFdxl(UV))-(_lf(F0)+_lf(FIR)+_lf(FUV))*SolarX)+@SurfaceEmissivity*(Pi*(_lf(IRt)+tk1*dFdxl(IRt))-(@[]IntPlanck[0]+TKK*(@IntPlanck[1]+TKK*(@IntPlanck[2]+TKK*@IntPlanck[3]))))+LambdaT/HX[x]*(T[right]-_lf(T)))/HX[x]);
          }
       if (IsRight)
          {
           double TKK = 273.15+_rg(T);
           double LambdaT = 1E-3*(4.39+0.071*TKK);

           _rg(T) += TAU/@SurfaceCC/@SurfaceRO*(@SurfaceLambda*(_d2Fdy2(_right,T) +_d2Fdz2(_right,T))+((1-@SurfaceAlbedo)* (Pi*(_rg(I)+_rg(IR)+_rg(UV)-k1*dFdxr(I)-rk1*dFdxr(IR)-uk1*dFdxr(UV))+(_rg(F0)+_rg(FIR)+_rg(FUV))*SolarX)+@SurfaceEmissivity*(Pi*(_rg(IRt)-tk1*dFdxr(IRt))-(@[]IntPlanck[0]+TKK*(@IntPlanck[1]+TKK*(@IntPlanck[2]+TKK*@IntPlanck[3]))))+LambdaT/HX[XM]*(T[left]-_rg(T)))/HX[XM]);
          }
      }
</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqT" ContID="Bound" Color="#FF8080" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="K_T_Uz" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="365" Top="333"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0"></Parameter>
    <Parameter ID="Expression" Indent="0">@BT*9.81*(T-@T0);</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="P_U" ContID="KoeffUz" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="K_T_P" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="461" Top="246"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0"></Parameter>
    <Parameter ID="Expression" Indent="0">Split{0.0,@RO*@BT*9.81*dFdz(T)};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="P_U" ContID="KoeffP" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_MultiPhase" ParentID="" ID="Drops" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="193" Top="1763"/>
   <Parameters NumItems="3">
    <Parameter ID="Uw" Indent="0">@UwLight{Drops}</Parameter>
    <Parameter ID="Source" Indent="0">H2O</Parameter>
    <Parameter ID="Nc" Indent="0">7</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Model">
     <Link ElementID="Model" ContID="Other" Informational="False"/>
    </Contact>
    <Contact ID="SourceK">
     <Link ElementID="Drops_Source" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Ro">
     <Link ElementID="Rok" ContID="PhasePrm" Color="#808040" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
    <Contact ID="U">
     <Link ElementID="Uk" ContID="PhasePrm" Color="#0080FF" Informational="False">
      <Points NumItems="2">361,1839,361,1959</Points>
     </Link>
    </Contact>
    <Contact ID="Define">
     <Link ElementID="Uk" ContID="Phase" Color="#FF8080" Informational="False">
      <Points NumItems="1">349,1984</Points>
     </Link>
     <Link ElementID="Rok" ContID="Phase" Color="#FF8080" Informational="False">
      <Points NumItems="2">373,1856,373,1805</Points>
     </Link>
     <Link ElementID="Nk" ContID="Phase" Color="#FF8080" Informational="False">
      <Points NumItems="1">349,2139</Points>
     </Link>
     <Link ElementID="K_Drops_SO2" ContID="Phase" Color="clYellow" Informational="False">
      <Points NumItems="5">365,1856,365,1684,324,1684,324,973,467,973</Points>
     </Link>
     <Link ElementID="SO2k" ContID="Phase" Color="#FF8080" Informational="False">
      <Points NumItems="1">349,2292</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Vector" ParentID="" ID="Uk" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="375" Top="1929"/>
   <Parameters NumItems="2">
    <Parameter ID="FBase" Indent="0">uk</Parameter>
    <Parameter ID="Desc" Indent="0">Скорость капель</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="PhasePrm">
     <Link ElementID="Drops" ContID="U" Informational="False"/>
    </Contact>
    <Contact ID="Phase">
     <Link ElementID="Drops" ContID="Define" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Vx">
     <Link ElementID="Ukx" ContID="Vector" Color="#004080" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
    <Contact ID="Vy">
     <Link ElementID="Uky" ContID="Vector" Color="#004080" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
    <Contact ID="Vz">
     <Link ElementID="Ukz" ContID="Vector" Color="#004080" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Projection" ParentID="" ID="Ukx" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="520" Top="1902"/>
   <Parameters NumItems="2">
    <Parameter ID="Init" Indent="0">0</Parameter>
    <Parameter ID="Restrict" Indent="0">Any</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Vector">
     <Link ElementID="Uk" ContID="Vx" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="EqUkx" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="1">623,1886</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Projection" ParentID="" ID="Uky" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="520" Top="1959"/>
   <Parameters NumItems="2">
    <Parameter ID="Init" Indent="0">0</Parameter>
    <Parameter ID="Restrict" Indent="0">Any</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Vector">
     <Link ElementID="Uk" ContID="Vy" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="EqUky" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Projection" ParentID="" ID="Ukz" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="520" Top="2016"/>
   <Parameters NumItems="2">
    <Parameter ID="Init" Indent="0">0</Parameter>
    <Parameter ID="Restrict" Indent="0">Any</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Vector">
     <Link ElementID="Uk" ContID="Vz" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="EqUkz" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Var" ParentID="" ID="Rok" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="388" Top="1763"/>
   <Parameters NumItems="4">
    <Parameter ID="Init" Indent="0">@[]InitRok{Drops}[i]</Parameter>
    <Parameter ID="Restrict" Indent="0">Positive</Parameter>
    <Parameter ID="FBase" Indent="0">rok</Parameter>
    <Parameter ID="Desc" Indent="0">Плотность капель</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="PhasePrm">
     <Link ElementID="Drops" ContID="Ro" Informational="False"/>
    </Contact>
    <Contact ID="Phase">
     <Link ElementID="Drops" ContID="Define" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="EqRok" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="1">517,1765</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_DynEquation" ParentID="" ID="EqRok" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="618" Top="1740"/>
   <Parameters NumItems="3">
    <Parameter ID="Handler" Indent="0">NULL</Parameter>
    <Parameter ID="NuMol" Indent="0">0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0</Parameter>
    <Parameter ID="Kappa" Indent="0">0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="Rok" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="K_Rok" ContID="Val" Informational="False"/>
     <Link ElementID="Inject_Rok" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="S">
     <Link ElementID="S_Rok" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Solver">
     <Link ElementID="Solver" ContID="Eqtn" Color="#C08000" Informational="False">
      <Points NumItems="3">743,1791,813,1656,814,414</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_DirectEquation" ParentID="" ID="EqUkx" Permanent="False">
   <Show Class="True" Name="True" Image="False"/>
   <Position Left="698" Top="1844"/>
   <Parameters NumItems="1">
    <Parameter ID="Handler" Indent="0">DirectSolver</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="Ukx" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="K_Ukx" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Solver">
     <Link ElementID="Solver" ContID="Eqtn" Color="#C08000" Informational="False">
      <Points NumItems="2">820,1903,820,418</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_DirectEquation" ParentID="" ID="EqUky" Permanent="False">
   <Show Class="True" Name="True" Image="False"/>
   <Position Left="698" Top="1944"/>
   <Parameters NumItems="1">
    <Parameter ID="Handler" Indent="0">DirectSolver</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="Uky" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="K_Uky" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Solver">
     <Link ElementID="Solver" ContID="Eqtn" Color="#C08000" Informational="False">
      <Points NumItems="2">828,2003,828,420</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_DirectEquation" ParentID="" ID="EqUkz" Permanent="False">
   <Show Class="True" Name="True" Image="False"/>
   <Position Left="697" Top="2043"/>
   <Parameters NumItems="1">
    <Parameter ID="Handler" Indent="0">DirectSolver</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="Ukz" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="K_Ukz" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Solver">
     <Link ElementID="Solver" ContID="Eqtn" Color="#C08000" Informational="False">
      <Points NumItems="2">837,2102,837,422</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="K_Ukx" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="618" Top="1926"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0"></Parameter>
    <Parameter ID="Expression" Indent="0">Ux;</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqUkx" ContID="K" Color="clRed" Informational="False">
      <Points NumItems="1">682,1903</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="K_Uky" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="618" Top="2017"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0"></Parameter>
    <Parameter ID="Expression" Indent="0">Uy;</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqUky" ContID="K" Color="clRed" Informational="False">
      <Points NumItems="1">681,2002</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="K_Ukz" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="604" Top="2096"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0"></Parameter>
    <Parameter ID="Expression" Indent="0">Split{0.0,fabs(@UwLight[i]) &gt; 1E-8 ? Uz - @UwLight[i] : Uz - GetdU(9.81, RO0, ROK, _Sigma, @D, DD[i], Uz - Ukz[i])};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqUkz" ContID="K" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="Drops_Source" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="66" Top="1797"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double Pi = 3.1415926535897932;
double Mk = 0.018;
double Ma = 0.0288;
double _R = 8.315;
double ROK = 1000.0;
double TK = 273.15+T;
double RO0 = 352.984/TK;
double CC0 = 1.4*(718+0.1167*RO0);
double Dvap0 = 0.211E-4*pow(TK/273.0,1.94);
double Lambda0 = 1E-3*(4.39+0.071*TK);
double Dvap1 = 2.0*Dvap0/@AlphaM{Drops}*sqrt(2.0*Pi*Mk/_R/TK);
double Lambda1 = 2.0*Lambda0/(@AlphaT{Drops}*RO0*CC0)*sqrt(2*Pi*Ma/_R/TK);
double _Hvap = 2.5E+6*pow(273.15/TK,0.167+3.67E-4*TK);
double _Ck = 4185.5*(0.99618+0.0002874*pow((TK-173)/100.0,5.26)+0.01116*pow(10.0,-0.036*T));
double PkF = (610.7799961+T*(44.36518521+T*(1.428945805+T*(2.650648471E-2+T*(3.031240396E-4+T*(2.034080948E-6+T*6.136820929E-9))))))/_R/TK;
double _Sigma = 0.0761-1.55E-4*T;
double PkF1 = 4.0*Mk*_Sigma/_R/TK/ROK;

vector EMPTY[i] = Nk[i]&lt;0.1*TAU || Rok[i] / Nk[i] &lt;= Pi / 6.0*ROK*(@[]Dk{Drops}[i] * @[]Dk{Drops}[i] * @[]Dk{Drops}[i]);
vector NMoles[i] = EMPTY[i] ? 0.0 : 1E6*max(0.0, SO2k[i])/Nk[i];
vector PkF2[i] = EMPTY[i] ? 0.0 : 6.0*NMoles[i]*Mk/Pi/ROK;
vector mCX[i] = EMPTY[i] ? 0.0 : 1E6*Source/PkF-exp(PkF1/@[]Dk{Drops}[i]-PkF2[i]/(@Dk[i]*@Dk[i]*@Dk[i]));
vector mCY[i] = EMPTY[i] ? 0.0 : 1E6*Source/PkF-exp(PkF1/@[]Dk{Drops}[i+1]-PkF2[i]/(@Dk[i+1]*@Dk[i+1]*@Dk[i+1]));
vector Mode[i] = mCX[i]*mCY[i]&lt;=0.0 || i==0 &amp;&amp; mCX[i]&lt;0.0 &amp;&amp; mCY[i]&lt;0.0 ? 0.0 : mCX[i]&lt;0.0 ? -1.0 : +1.0;
vector SPEC1[i] = i&gt;0 &amp;&amp; i&lt;Nc-1 &amp;&amp; Mode[i-1]&gt;0 &amp;&amp; Mode[i]&gt;0 &amp;&amp; EMPTY[i+1];
vector SPEC2[i] = i&gt;0 &amp;&amp; i&lt;Nc-1 &amp;&amp; EMPTY[i-1] &amp;&amp; Mode[i]&lt;0 &amp;&amp; Mode[i+1]&lt;0;
vector State[i] = EMPTY[i] ? 0.0 :
                   SPEC1[i] || SPEC2[i] ||
                   i==0 &amp;&amp; Mode[i]&gt;0 ||
                   i==Nc-1 &amp;&amp; Mode[i]&lt;0 ||
                   i&lt;Nc-1 &amp;&amp; Mode[i]&lt;0 &amp;&amp; Mode[i]!=Mode[i+1] ||
                   i&gt;0 &amp;&amp; Mode[i]&gt;0 &amp;&amp; Mode[i]!=Mode[i-1] ? -1.0 : 1.0;
vector CND1[i] = State[i]&lt;0 &amp;&amp; (Mode[i]&gt;0 &amp;&amp; !SPEC1[i] || SPEC2[i]);
vector CND2[i] = State[i]&lt;0 &amp;&amp; (Mode[i]&lt;0 &amp;&amp; !SPEC2[i] || SPEC1[i]);
vector ppX[i] = EMPTY[i] ? @Dk[i] : CND1[i] ? amax2(@Dk[i],GetXY(@Dk[i+1],24.0*Rok[i]/(Pi*ROK*Nk[i]))) : @Dk[i];
vector ppY[i] = EMPTY[i] ? @Dk[i+1] : CND2[i] ? amin2(@Dk[i+1],GetXY(@Dk[i],24.0*Rok[i]/(Pi*ROK*Nk[i]))) : @Dk[i+1];
vector X[i] = ppX[i] &lt; ppY[i] ? ppX[i] : 0.25*@[]Dk[i] + 0.75*@[]Dk[i + 1];
vector Y[i] = ppX[i] &lt; ppY[i] ? ppY[i] : 0.75*@[]Dk[i] + 0.25*@[]Dk[i + 1];
vector dCX[i] = Mode[i]==0 ? 0.0 : CND1[i] ? 1E6*Source/PkF-exp(PkF1/X[i]-PkF2[i]/(X[i]*X[i]*X[i])) : mCX[i];
vector dCY[i] = Mode[i]==0 ? 0.0 : CND2[i] ? 1E6*Source/PkF-exp(PkF1/Y[i]-PkF2[i]/(Y[i]*Y[i]*Y[i])) : mCY[i];
vector _XYC[i] = EMPTY[i] ? 0.5*(@[]Dk[i]+@[]Dk[i+1]) : 0.5*(X[i] + Y[i]);
vector X2[i] = X[i]*X[i];
vector X3[i] = X2[i]*X[i];
vector X4[i] = X3[i]*X[i];
vector X5[i] = X4[i]*X[i];
vector X6[i] = X5[i]*X[i];
vector X7[i] = X6[i]*X[i];
vector X8[i] = X7[i]*X[i];
vector X9[i] = X8[i]*X[i];
vector Y2[i] = Y[i]*Y[i];
vector Y3[i] = Y2[i]*Y[i];
vector Y4[i] = Y3[i]*Y[i];
vector Y5[i] = Y4[i]*Y[i];
vector Y6[i] = Y5[i]*Y[i];
vector Y7[i] = Y6[i]*Y[i];
vector Y8[i] = Y7[i]*Y[i];
vector Y9[i] = Y8[i]*Y[i];

vector XY1[i] = (Y[i]-X[i]);
vector XY2[i] = (Y2[i]-X2[i])/2.0;
vector XY3[i] = (Y3[i]-X3[i])/3.0;
vector XY4[i] = (Y4[i]-X4[i])/4.0;
vector XY5[i] = (Y5[i]-X5[i])/5.0;
vector XY6[i] = (Y6[i]-X6[i])/6.0;
vector XY7[i] = (Y7[i]-X7[i])/7.0;
vector XY8[i] = (Y8[i]-X8[i])/8.0;
vector XY9[i] = (Y9[i]-X9[i])/9.0;

vector A1[i] = (EMPTY[i] || State[i]&lt;0.0) ? 0.0 : XY2[i];
vector B1[i] = (EMPTY[i] || State[i]&lt;0.0) ? 0.0 : XY1[i];
vector A2[i] = (EMPTY[i] || State[i]&lt;0.0) ? 0.0 : XY5[i];
vector B2[i] = (EMPTY[i] || State[i]&lt;0.0) ? 0.0 : XY4[i];
vector nC2[i] = (EMPTY[i] || State[i]&lt;0.0) ? 0.0 : 6.0*Rok[i]/Pi/ROK;
vector Determ[i] = (EMPTY[i] || State[i]&lt;0.0) ? 0.0 : A1[i]*B2[i]-B1[i]*A2[i];
vector AnC[i] = EMPTY[i] ? 0.0 : State[i]&lt;0.0 ? 0.0 : (B2[i]*Nk[i]-B1[i]*nC2[i])/Determ[i];
vector BnC[i] = EMPTY[i] ? 0.0 : State[i]&lt;0.0 ? Nk[i]/(Y[i]-X[i]) : (-A2[i]*Nk[i]+A1[i]*nC2[i])/Determ[i];
vector CORR[i] = EMPTY[i] ? 0.0 : AnC[i]*X[i]+BnC[i]&lt;0.0 || AnC[i]*Y[i]+BnC[i]&lt;0.0;
vector __An[i] = EMPTY[i] ? 0.0 : CORR[i] ? 0.0 : AnC[i];
vector __Bn[i] = EMPTY[i] ? 0.0 : CORR[i] ? Nk[i]/(Y[i]-X[i]) : BnC[i];

vector dUkx[i] = Ux-Ukx[i];
vector dUky[i] = Uy-Uky[i];
vector dUkz[i] = Uz-Ukz[i];
vector dUk[i] = fabs(@UwLight[i]) &gt; 1E-8 ? 0.0 : sqrt(dUkx[i]*dUkx[i]+dUky[i]*dUky[i]+dUkz[i]*dUkz[i]);
vector DC[i] = 0.5*(@[]Dk[i] + @[]Dk[i + 1]);
vector Rek[i] = fabs(@UwLight[i]) &gt; 1E-8 ? 0.0 : DC[i] * dUk[i] / @D;
vector Prk[i] = @D*ROK*_Ck / Lambda0*(1.0 + Lambda1 / DC[i]);
vector Sck[i] = @D / Dvap0*(1.0 + Dvap1 / DC[i]);
vector sRek[i] = fabs(@UwLight[i]) &gt; 1E-8 ? 0.0 : sqrt(Rek[i]);
vector Nuss1[i] = fabs(@UwLight[i]) &gt; 1E-8 ? 2.0 : 2.0 + 0.6*sRek[i] * pow(Sck[i], 1.0 / 3.0);
vector Nuss2[i] = fabs(@UwLight[i]) &gt; 1E-8 ? 2.0 : 2.0 + 0.6*sRek[i] * pow(Prk[i], 1.0 / 3.0);
vector PkF3[i] = ROK/2.0/Nuss1[i]/PkF/Mk;
vector PkF4[i] = _Hvap*ROK/2.0/Nuss2[i]/TK*(_Hvap*Mk/_R/TK-1.0);
vector LX[i] = EMPTY[i] ? 0.0 : 0.5*ROK*dCX[i]/(PkF3[i]/Dvap0*(1.0+Dvap1/X[i])+PkF4[i]/Lambda0*(1.0+Lambda1/X[i]));
vector LY[i] = EMPTY[i] ? 0.0 : 0.5*ROK*dCY[i]/(PkF3[i]/Dvap0*(1.0+Dvap1/Y[i])+PkF4[i]/Lambda0*(1.0+Lambda1/Y[i]));
vector Dz[i] = EMPTY[i] || fabs(Y[i] - @Dk[i + 1])&gt;1E-15 ? Y[i] : LX[i]&lt;0 ? Y[i] : max(X[i], min(Y[i], Y[i] - TAU*2.0*LY[i] / ROK / Y[i]));
vector Dzz[i] = EMPTY[i] || fabs(X[i] - @Dk[i])&gt;1E-15 ? X[i] : LX[i]&lt;0 ? max(X[i], min(Y[i], X[i] - TAU*2.0*LX[i] / ROK / X[i])) : X[i];

vector XYC[i] = EMPTY[i] ? _XYC[i] : _XYC[i] &lt; Dzz[i] ? Dzz[i] : _XYC[i] &gt; Dz[i] ? Dz[i] : _XYC[i];
vector XYC2[i] = XYC[i] * XYC[i];
vector XYC3[i] = XYC2[i] * XYC[i];
vector XYC4[i] = XYC3[i] * XYC[i];
vector XYC5[i] = XYC4[i] * XYC[i];
vector XYC6[i] = XYC5[i] * XYC[i];
vector XYC7[i] = XYC6[i] * XYC[i];

vector XC1[i] = (XYC[i] - X[i]) / 1.0;
vector XC2[i] = (XYC2[i] - X2[i]) / 2.0;
vector XC3[i] = (XYC3[i] - X3[i]) / 3.0;
vector XC4[i] = (XYC4[i] - X4[i]) / 4.0;
vector XC5[i] = (XYC5[i] - X5[i]) / 5.0;
vector XC6[i] = (XYC6[i] - X6[i]) / 6.0;
vector XC7[i] = (XYC7[i] - X7[i]) / 7.0;
vector XC8[i] = (XYC7[i]*XYC[i] - X8[i]) / 8.0;
vector XC9[i] = (XYC7[i]*XYC2[i] - X9[i]) / 9.0;
vector XC10[i] = (XYC7[i]*XYC3[i] - X9[i]*X[i]) / 10.0;
vector XC11[i] = (XYC7[i]*XYC4[i] - X9[i]*X2[i]) / 11.0;

vector CY1[i] = -(XYC[i] - Y[i]) / 1.0;
vector CY2[i] = -(XYC2[i] - Y2[i]) / 2.0;
vector CY3[i] = -(XYC3[i] - Y3[i]) / 3.0;
vector CY4[i] = -(XYC4[i] - Y4[i]) / 4.0;
vector CY5[i] = -(XYC5[i] - Y5[i]) / 5.0;
vector CY6[i] = -(XYC6[i] - Y6[i]) / 6.0;
vector CY7[i] = -(XYC7[i] - Y7[i]) / 7.0;
vector CY8[i] = -(XYC7[i] * XYC[i] - Y8[i]) / 8.0;
vector CY9[i] = -(XYC7[i] * XYC2[i] - Y9[i]) / 9.0;
vector CY10[i] = -(XYC7[i] * XYC3[i] - Y9[i] * Y[i]) / 10.0;
vector CY11[i] = -(XYC7[i] * XYC4[i] - Y9[i] * Y2[i]) / 11.0;

vector _Dnn[i] = EMPTY[i] ? 0.0 : (i == 0 || EMPTY[i - 1]) ? __Bn[i] : 0.0;
vector _Cnn[i] = EMPTY[i] ? 0.0 : (i == 0 || EMPTY[i-1]) ? __An[i] : 0.0;
vector _Bnn[i] = 0.0;
vector _Ann[i] = EMPTY[i] ? 0.0 : (i == 0 || EMPTY[i-1]) ? 0.0 : getLeftSpline(i, Dk, XYC, XYC2, XYC3, XYC4, XYC5, XYC6, XYC7, ROK, __An, __Bn, _Ann, _Bnn, _Cnn, _Dnn);
vector CORR_ABCDnn[i] = _Ann[i] * X3[i] + _Bnn[i] * X2[i] + _Cnn[i] * X[i] + _Dnn[i] &gt;= 0.0;
vector Dnn[i] = CORR_ABCDnn[i] ? _Dnn[i] : __Bn[i];
vector Cnn[i] = CORR_ABCDnn[i] ? _Cnn[i] : __An[i];
vector Bnn[i] = CORR_ABCDnn[i] ? _Bnn[i] : 0.0;
vector Ann[i] = CORR_ABCDnn[i] ? _Ann[i] : 0.0;

vector _Dn[i] = EMPTY[i] ? 0.0 : (i == Nc-1 || EMPTY[i + 1]) ? __Bn[i] : 0.0;
vector _Cn[i] = EMPTY[i] ? 0.0 : (i == Nc-1 || EMPTY[i + 1]) ? __An[i] : 0.0;
vector _Bn[i] = 0.0;
vector _An[i] = EMPTY[i] ? 0.0 : (i == Nc-1 || EMPTY[i + 1]) ? 0.0 : getRightSpline(i, Dk, XYC, XYC2, XYC3, XYC4, XYC5, XYC6, XYC7, ROK, __An, __Bn, _An, _Bn, _Cn, _Dn);
vector CORR_ABCDn[i] = _An[i] * X3[i] + _Bn[i] * X2[i] + _Cn[i] * X[i] + _Dn[i] &gt;= 0.0;
vector Dn[i] = CORR_ABCDn[i] ? _Dn[i] : __Bn[i];
vector Cn[i] = CORR_ABCDn[i] ? _Cn[i] : __An[i];
vector Bn[i] = CORR_ABCDn[i] ? _Bn[i] : 0.0;
vector An[i] = CORR_ABCDn[i] ? _An[i] : 0.0;

vector kCSubst[i] = EMPTY[i] ? 0.0 : max(0.0, max(ROK/Rok[i], 6.0 / (Pi*(
		   An[i] / 7.0*(Y7[i] - XYC7[i]) + Bn[i] / 6.0*(Y6[i] - XYC6[i]) + Cn[i] / 5.0*(Y5[i] - XYC5[i]) + Dn[i] / 4.0*(Y4[i] - XYC4[i]) +
		   Ann[i] / 7.0*(XYC7[i] - X7[i]) + Bnn[i] / 6.0*(XYC6[i] - X6[i]) + Cnn[i] / 5.0*(XYC5[i] - X5[i]) + Dnn[i] / 4.0*(XYC4[i] - X4[i])
		   ))));
vector _DD[i] = EMPTY[i] ? (@Dk[i] + @Dk[i + 1]) / 2.0 : (An[i] / 5.0*(Y5[i] - XYC5[i]) + Bn[i] / 4.0*(Y4[i] - XYC4[i]) + Cn[i] / 3.0*(Y3[i] - XYC3[i]) + Dn[i] / 2.0*(Y2[i] - XYC2[i]) +
		   Ann[i] / 5.0*(XYC5[i] - X5[i]) + Bnn[i] / 4.0*(XYC4[i] - X4[i]) + Cnn[i] / 3.0*(XYC3[i] - X3[i]) + Dnn[i] / 2.0*(XYC2[i] - X2[i])) / Nk[i];
vector DD[i] = _DD[i] &lt; @Dk[i] || _DD[i] &gt; @Dk[i + 1] ? (@Dk[i] + @Dk[i + 1]) / 2.0 : _DD[i];
vector nX[i] = EMPTY[i] ? 0.0 : Ann[i] * X3[i] + Bnn[i] * X2[i] + Cnn[i] * X[i] + Dnn[i];
vector nY[i] = EMPTY[i] ? 0.0 : An[i] * Y3[i] + Bn[i] * Y2[i] + Cn[i] * Y[i] + Dn[i];

vector LDp[i] = EMPTY[i] || Mode[i]==0.0 ? 0.0 : 0.5*ROK*(1E6*Source/PkF-exp(PkF1/DD[i]-PkF2[i]/(DD[i]*DD[i]*DD[i])))/(PkF3[i]/Dvap0*(1.0+Dvap1/DD[i])+PkF4[i]/Lambda0*(1.0+Lambda1/DD[i]));

vector ieC0[i] = @[]QeC0{Drops}[i];
vector ieC1[i] = @[]QeC1{Drops}[i]*1E6;
vector ieC2[i] = @[]QeC2{Drops}[i]*1E12;
vector ieC3[i] = @[]QeC3{Drops}[i]*1E18;
vector ieC4[i] = @[]QeC4{Drops}[i]*1E24;
vector ieC5[i] = @[]QeC5{Drops}[i]*1E30;
vector iaC0[i] = @[]QaC0{Drops}[i];
vector iaC1[i] = @[]QaC1{Drops}[i]*1E6;
vector iaC2[i] = @[]QaC2{Drops}[i]*1E12;
vector iaC3[i] = @[]QaC3{Drops}[i]*1E18;
vector iaC4[i] = @[]QaC4{Drops}[i]*1E24;
vector iaC5[i] = @[]QaC5{Drops}[i]*1E30;
vector igC0[i] = @[]gC0{Drops}[i];
vector igC1[i] = @[]gC1{Drops}[i]*1E6;
vector igC2[i] = @[]gC2{Drops}[i]*1E12;
vector igC3[i] = @[]gC3{Drops}[i]*1E18;
vector igC4[i] = @[]gC4{Drops}[i]*1E24;
vector igC5[i] = @[]gC5{Drops}[i]*1E30;

vector uieC0[i] = @[]uQeC0{Drops}[i];
vector uieC1[i] = @[]uQeC1{Drops}[i]*1E6;
vector uieC2[i] = @[]uQeC2{Drops}[i]*1E12;
vector uieC3[i] = @[]uQeC3{Drops}[i]*1E18;
vector uieC4[i] = @[]uQeC4{Drops}[i]*1E24;
vector uieC5[i] = @[]uQeC5{Drops}[i]*1E30;
vector uiaC0[i] = @[]uQaC0{Drops}[i];
vector uiaC1[i] = @[]uQaC1{Drops}[i]*1E6;
vector uiaC2[i] = @[]uQaC2{Drops}[i]*1E12;
vector uiaC3[i] = @[]uQaC3{Drops}[i]*1E18;
vector uiaC4[i] = @[]uQaC4{Drops}[i]*1E24;
vector uiaC5[i] = @[]uQaC5{Drops}[i]*1E30;
vector uigC0[i] = @[]ugC0{Drops}[i];
vector uigC1[i] = @[]ugC1{Drops}[i]*1E6;
vector uigC2[i] = @[]ugC2{Drops}[i]*1E12;
vector uigC3[i] = @[]ugC3{Drops}[i]*1E18;
vector uigC4[i] = @[]ugC4{Drops}[i]*1E24;
vector uigC5[i] = @[]ugC5{Drops}[i]*1E30;

vector rieC0[i] = @[]rQeC0{Drops}[i];
vector rieC1[i] = @[]rQeC1{Drops}[i]*1E6;
vector rieC2[i] = @[]rQeC2{Drops}[i]*1E12;
vector rieC3[i] = @[]rQeC3{Drops}[i]*1E18;
vector rieC4[i] = @[]rQeC4{Drops}[i]*1E24;
vector rieC5[i] = @[]rQeC5{Drops}[i]*1E30;
vector riaC0[i] = @[]rQaC0{Drops}[i];
vector riaC1[i] = @[]rQaC1{Drops}[i]*1E6;
vector riaC2[i] = @[]rQaC2{Drops}[i]*1E12;
vector riaC3[i] = @[]rQaC3{Drops}[i]*1E18;
vector riaC4[i] = @[]rQaC4{Drops}[i]*1E24;
vector riaC5[i] = @[]rQaC5{Drops}[i]*1E30;
vector rigC0[i] = @[]rgC0{Drops}[i];
vector rigC1[i] = @[]rgC1{Drops}[i]*1E6;
vector rigC2[i] = @[]rgC2{Drops}[i]*1E12;
vector rigC3[i] = @[]rgC3{Drops}[i]*1E18;
vector rigC4[i] = @[]rgC4{Drops}[i]*1E24;
vector rigC5[i] = @[]rgC5{Drops}[i]*1E30;

vector tieC0[i] = @[]tQeC0{Drops}[i];
vector tieC1[i] = @[]tQeC1{Drops}[i]*1E6;
vector tieC2[i] = @[]tQeC2{Drops}[i]*1E12;
vector tieC3[i] = @[]tQeC3{Drops}[i]*1E18;
vector tieC4[i] = @[]tQeC4{Drops}[i]*1E24;
vector tieC5[i] = @[]tQeC5{Drops}[i]*1E30;
vector tiaC0[i] = @[]tQaC0{Drops}[i];
vector tiaC1[i] = @[]tQaC1{Drops}[i]*1E6;
vector tiaC2[i] = @[]tQaC2{Drops}[i]*1E12;
vector tiaC3[i] = @[]tQaC3{Drops}[i]*1E18;
vector tiaC4[i] = @[]tQaC4{Drops}[i]*1E24;
vector tiaC5[i] = @[]tQaC5{Drops}[i]*1E30;
vector tigC0[i] = @[]tgC0{Drops}[i];
vector tigC1[i] = @[]tgC1{Drops}[i]*1E6;
vector tigC2[i] = @[]tgC2{Drops}[i]*1E12;
vector tigC3[i] = @[]tgC3{Drops}[i]*1E18;
vector tigC4[i] = @[]tgC4{Drops}[i]*1E24;
vector tigC5[i] = @[]tgC5{Drops}[i]*1E30;

vector iBeta[i] = Split{0.0,EMPTY[i] ? 0.0 :
	   min(1E-2/max(HX[x],max(HY[y],HZ[z])), max(1E-5, Pi / 4.0*
	   (
	   Ann[i] * (ieC0[i] * XC6[i] + ieC1[i] * XC7[i] + ieC2[i] * XC8[i] + ieC3[i] * XC9[i] + ieC4[i] * XC10[i] + ieC5[i] * XC11[i]) +
	   Bnn[i] * (ieC0[i] * XC5[i] + ieC1[i] * XC6[i] + ieC2[i] * XC7[i] + ieC3[i] * XC8[i] + ieC4[i] * XC9[i] + ieC5[i] * XC10[i]) +
	   Cnn[i] * (ieC0[i] * XC4[i] + ieC1[i] * XC5[i] + ieC2[i] * XC6[i] + ieC3[i] * XC7[i] + ieC4[i] * XC8[i] + ieC5[i] * XC9[i]) +
	   Dnn[i] * (ieC0[i] * XC3[i] + ieC1[i] * XC4[i] + ieC2[i] * XC5[i] + ieC3[i] * XC6[i] + ieC4[i] * XC7[i] + ieC5[i] * XC8[i]) +
	   An[i] * (ieC0[i] * CY6[i] + ieC1[i] * CY7[i] + ieC2[i] * CY8[i] + ieC3[i] * CY9[i] + ieC4[i] * CY10[i] + ieC5[i] * CY11[i]) +
	   Bn[i] * (ieC0[i] * CY5[i] + ieC1[i] * CY6[i] + ieC2[i] * CY7[i] + ieC3[i] * CY8[i] + ieC4[i] * CY9[i] + ieC5[i] * CY10[i]) +
	   Cn[i] * (ieC0[i] * CY4[i] + ieC1[i] * CY5[i] + ieC2[i] * CY6[i] + ieC3[i] * CY7[i] + ieC4[i] * CY8[i] + ieC5[i] * CY9[i]) +
	   Dn[i] * (ieC0[i] * CY3[i] + ieC1[i] * CY4[i] + ieC2[i] * CY5[i] + ieC3[i] * CY6[i] + ieC4[i] * CY7[i] + ieC5[i] * CY8[i])
	   )))
                  };
vector uiBeta[i] = Split{0.0,EMPTY[i] ? 0.0 :
	   min(1E-2/max(HX[x],max(HY[y], HZ[z])), max(1E-5, Pi / 4.0*
	   (
	   Ann[i] * (uieC0[i] * XC6[i] + uieC1[i] * XC7[i] + uieC2[i] * XC8[i] + uieC3[i] * XC9[i] + uieC4[i] * XC10[i] + uieC5[i] * XC11[i]) +
	   Bnn[i] * (uieC0[i] * XC5[i] + uieC1[i] * XC6[i] + uieC2[i] * XC7[i] + uieC3[i] * XC8[i] + uieC4[i] * XC9[i] + uieC5[i] * XC10[i]) +
	   Cnn[i] * (uieC0[i] * XC4[i] + uieC1[i] * XC5[i] + uieC2[i] * XC6[i] + uieC3[i] * XC7[i] + uieC4[i] * XC8[i] + uieC5[i] * XC9[i]) +
	   Dnn[i] * (uieC0[i] * XC3[i] + uieC1[i] * XC4[i] + uieC2[i] * XC5[i] + uieC3[i] * XC6[i] + uieC4[i] * XC7[i] + uieC5[i] * XC8[i]) +
	   An[i] * (uieC0[i] * CY6[i] + uieC1[i] * CY7[i] + uieC2[i] * CY8[i] + uieC3[i] * CY9[i] + uieC4[i] * CY10[i] + uieC5[i] * CY11[i]) +
	   Bn[i] * (uieC0[i] * CY5[i] + uieC1[i] * CY6[i] + uieC2[i] * CY7[i] + uieC3[i] * CY8[i] + uieC4[i] * CY9[i] + uieC5[i] * CY10[i]) +
	   Cn[i] * (uieC0[i] * CY4[i] + uieC1[i] * CY5[i] + uieC2[i] * CY6[i] + uieC3[i] * CY7[i] + uieC4[i] * CY8[i] + uieC5[i] * CY9[i]) +
	   Dn[i] * (uieC0[i] * CY3[i] + uieC1[i] * CY4[i] + uieC2[i] * CY5[i] + uieC3[i] * CY6[i] + uieC4[i] * CY7[i] + uieC5[i] * CY8[i])
	   )))
                  };
vector riBeta[i] = Split{0.0,EMPTY[i] ? 0.0 :
	   min(1E-2/max(HX[x],max(HY[y], HZ[z])), max(1E-5, Pi / 4.0*
	   (
	   Ann[i] * (rieC0[i] * XC6[i] + rieC1[i] * XC7[i] + rieC2[i] * XC8[i] + rieC3[i] * XC9[i] + rieC4[i] * XC10[i] + rieC5[i] * XC11[i]) +
	   Bnn[i] * (rieC0[i] * XC5[i] + rieC1[i] * XC6[i] + rieC2[i] * XC7[i] + rieC3[i] * XC8[i] + rieC4[i] * XC9[i] + rieC5[i] * XC10[i]) +
	   Cnn[i] * (rieC0[i] * XC4[i] + rieC1[i] * XC5[i] + rieC2[i] * XC6[i] + rieC3[i] * XC7[i] + rieC4[i] * XC8[i] + rieC5[i] * XC9[i]) +
	   Dnn[i] * (rieC0[i] * XC3[i] + rieC1[i] * XC4[i] + rieC2[i] * XC5[i] + rieC3[i] * XC6[i] + rieC4[i] * XC7[i] + rieC5[i] * XC8[i]) +
	   An[i] * (rieC0[i] * CY6[i] + rieC1[i] * CY7[i] + rieC2[i] * CY8[i] + rieC3[i] * CY9[i] + rieC4[i] * CY10[i] + rieC5[i] * CY11[i]) +
	   Bn[i] * (rieC0[i] * CY5[i] + rieC1[i] * CY6[i] + rieC2[i] * CY7[i] + rieC3[i] * CY8[i] + rieC4[i] * CY9[i] + rieC5[i] * CY10[i]) +
	   Cn[i] * (rieC0[i] * CY4[i] + rieC1[i] * CY5[i] + rieC2[i] * CY6[i] + rieC3[i] * CY7[i] + rieC4[i] * CY8[i] + rieC5[i] * CY9[i]) +
	   Dn[i] * (rieC0[i] * CY3[i] + rieC1[i] * CY4[i] + rieC2[i] * CY5[i] + rieC3[i] * CY6[i] + rieC4[i] * CY7[i] + rieC5[i] * CY8[i])
	   )))
                  };
vector tiBeta[i] = Split{0.0,EMPTY[i] ? 0.0 :
	   min(1E-2/max(HX[x],max(HY[y], HZ[z])), max(1E-5, Pi / 4.0*
	   (
	   Ann[i] * (tieC0[i] * XC6[i] + tieC1[i] * XC7[i] + tieC2[i] * XC8[i] + tieC3[i] * XC9[i] + tieC4[i] * XC10[i] + tieC5[i] * XC11[i]) +
	   Bnn[i] * (tieC0[i] * XC5[i] + tieC1[i] * XC6[i] + tieC2[i] * XC7[i] + tieC3[i] * XC8[i] + tieC4[i] * XC9[i] + tieC5[i] * XC10[i]) +
	   Cnn[i] * (tieC0[i] * XC4[i] + tieC1[i] * XC5[i] + tieC2[i] * XC6[i] + tieC3[i] * XC7[i] + tieC4[i] * XC8[i] + tieC5[i] * XC9[i]) +
	   Dnn[i] * (tieC0[i] * XC3[i] + tieC1[i] * XC4[i] + tieC2[i] * XC5[i] + tieC3[i] * XC6[i] + tieC4[i] * XC7[i] + tieC5[i] * XC8[i]) +
	   An[i] * (tieC0[i] * CY6[i] + tieC1[i] * CY7[i] + tieC2[i] * CY8[i] + tieC3[i] * CY9[i] + tieC4[i] * CY10[i] + tieC5[i] * CY11[i]) +
	   Bn[i] * (tieC0[i] * CY5[i] + tieC1[i] * CY6[i] + tieC2[i] * CY7[i] + tieC3[i] * CY8[i] + tieC4[i] * CY9[i] + tieC5[i] * CY10[i]) +
	   Cn[i] * (tieC0[i] * CY4[i] + tieC1[i] * CY5[i] + tieC2[i] * CY6[i] + tieC3[i] * CY7[i] + tieC4[i] * CY8[i] + tieC5[i] * CY9[i]) +
	   Dn[i] * (tieC0[i] * CY3[i] + tieC1[i] * CY4[i] + tieC2[i] * CY5[i] + tieC3[i] * CY6[i] + tieC4[i] * CY7[i] + tieC5[i] * CY8[i])
	   )))
                  };
vector iAbs[i] = Split{0.0,EMPTY[i] ? 0.0 :
	   min(iBeta[i], max(0.0, Pi / 4.0*
	   (
	   Ann[i] * (iaC0[i] * XC6[i] + iaC1[i] * XC7[i] + iaC2[i] * XC8[i] + iaC3[i] * XC9[i] + iaC4[i] * XC10[i] + iaC5[i] * XC11[i]) +
	   Bnn[i] * (iaC0[i] * XC5[i] + iaC1[i] * XC6[i] + iaC2[i] * XC7[i] + iaC3[i] * XC8[i] + iaC4[i] * XC9[i] + iaC5[i] * XC10[i]) +
	   Cnn[i] * (iaC0[i] * XC4[i] + iaC1[i] * XC5[i] + iaC2[i] * XC6[i] + iaC3[i] * XC7[i] + iaC4[i] * XC8[i] + iaC5[i] * XC9[i]) +
	   Dnn[i] * (iaC0[i] * XC3[i] + iaC1[i] * XC4[i] + iaC2[i] * XC5[i] + iaC3[i] * XC6[i] + iaC4[i] * XC7[i] + iaC5[i] * XC8[i]) +
	   An[i] * (iaC0[i] * CY6[i] + iaC1[i] * CY7[i] + iaC2[i] * CY8[i] + iaC3[i] * CY9[i] + iaC4[i] * CY10[i] + iaC5[i] * CY11[i]) +
	   Bn[i] * (iaC0[i] * CY5[i] + iaC1[i] * CY6[i] + iaC2[i] * CY7[i] + iaC3[i] * CY8[i] + iaC4[i] * CY9[i] + iaC5[i] * CY10[i]) +
	   Cn[i] * (iaC0[i] * CY4[i] + iaC1[i] * CY5[i] + iaC2[i] * CY6[i] + iaC3[i] * CY7[i] + iaC4[i] * CY8[i] + iaC5[i] * CY9[i]) +
	   Dn[i] * (iaC0[i] * CY3[i] + iaC1[i] * CY4[i] + iaC2[i] * CY5[i] + iaC3[i] * CY6[i] + iaC4[i] * CY7[i] + iaC5[i] * CY8[i])
	   )))
                 };
vector uiAbs[i] = Split{0.0,EMPTY[i] ? 0.0 :
	   min(uiBeta[i], max(0.0, Pi / 4.0*
	   (
	   Ann[i] * (uiaC0[i] * XC6[i] + uiaC1[i] * XC7[i] + uiaC2[i] * XC8[i] + uiaC3[i] * XC9[i] + uiaC4[i] * XC10[i] + uiaC5[i] * XC11[i]) +
	   Bnn[i] * (uiaC0[i] * XC5[i] + uiaC1[i] * XC6[i] + uiaC2[i] * XC7[i] + uiaC3[i] * XC8[i] + uiaC4[i] * XC9[i] + uiaC5[i] * XC10[i]) +
	   Cnn[i] * (uiaC0[i] * XC4[i] + uiaC1[i] * XC5[i] + uiaC2[i] * XC6[i] + uiaC3[i] * XC7[i] + uiaC4[i] * XC8[i] + uiaC5[i] * XC9[i]) +
	   Dnn[i] * (uiaC0[i] * XC3[i] + uiaC1[i] * XC4[i] + uiaC2[i] * XC5[i] + uiaC3[i] * XC6[i] + uiaC4[i] * XC7[i] + uiaC5[i] * XC8[i]) +
	   An[i] * (uiaC0[i] * CY6[i] + uiaC1[i] * CY7[i] + uiaC2[i] * CY8[i] + uiaC3[i] * CY9[i] + uiaC4[i] * CY10[i] + uiaC5[i] * CY11[i]) +
	   Bn[i] * (uiaC0[i] * CY5[i] + uiaC1[i] * CY6[i] + uiaC2[i] * CY7[i] + uiaC3[i] * CY8[i] + uiaC4[i] * CY9[i] + uiaC5[i] * CY10[i]) +
	   Cn[i] * (uiaC0[i] * CY4[i] + uiaC1[i] * CY5[i] + uiaC2[i] * CY6[i] + uiaC3[i] * CY7[i] + uiaC4[i] * CY8[i] + uiaC5[i] * CY9[i]) +
	   Dn[i] * (uiaC0[i] * CY3[i] + uiaC1[i] * CY4[i] + uiaC2[i] * CY5[i] + uiaC3[i] * CY6[i] + uiaC4[i] * CY7[i] + uiaC5[i] * CY8[i])
	   )))
                 };
vector riAbs[i] = Split{0.0,EMPTY[i] ? 0.0 :
	   min(riBeta[i], max(0.0, Pi / 4.0*
	   (
	   Ann[i] * (riaC0[i] * XC6[i] + riaC1[i] * XC7[i] + riaC2[i] * XC8[i] + riaC3[i] * XC9[i] + riaC4[i] * XC10[i] + riaC5[i] * XC11[i]) +
	   Bnn[i] * (riaC0[i] * XC5[i] + riaC1[i] * XC6[i] + riaC2[i] * XC7[i] + riaC3[i] * XC8[i] + riaC4[i] * XC9[i] + riaC5[i] * XC10[i]) +
	   Cnn[i] * (riaC0[i] * XC4[i] + riaC1[i] * XC5[i] + riaC2[i] * XC6[i] + riaC3[i] * XC7[i] + riaC4[i] * XC8[i] + riaC5[i] * XC9[i]) +
	   Dnn[i] * (riaC0[i] * XC3[i] + riaC1[i] * XC4[i] + riaC2[i] * XC5[i] + riaC3[i] * XC6[i] + riaC4[i] * XC7[i] + riaC5[i] * XC8[i]) +
	   An[i] * (riaC0[i] * CY6[i] + riaC1[i] * CY7[i] + riaC2[i] * CY8[i] + riaC3[i] * CY9[i] + riaC4[i] * CY10[i] + riaC5[i] * CY11[i]) +
	   Bn[i] * (riaC0[i] * CY5[i] + riaC1[i] * CY6[i] + riaC2[i] * CY7[i] + riaC3[i] * CY8[i] + riaC4[i] * CY9[i] + riaC5[i] * CY10[i]) +
	   Cn[i] * (riaC0[i] * CY4[i] + riaC1[i] * CY5[i] + riaC2[i] * CY6[i] + riaC3[i] * CY7[i] + riaC4[i] * CY8[i] + riaC5[i] * CY9[i]) +
	   Dn[i] * (riaC0[i] * CY3[i] + riaC1[i] * CY4[i] + riaC2[i] * CY5[i] + riaC3[i] * CY6[i] + riaC4[i] * CY7[i] + riaC5[i] * CY8[i])
	   )))
                 };
vector tiAbs[i] = Split{0.0,EMPTY[i] ? 0.0 :
	   min(tiBeta[i], max(0.0, Pi / 4.0*
	   (
	   Ann[i] * (tiaC0[i] * XC6[i] + tiaC1[i] * XC7[i] + tiaC2[i] * XC8[i] + tiaC3[i] * XC9[i] + tiaC4[i] * XC10[i] + tiaC5[i] * XC11[i]) +
	   Bnn[i] * (tiaC0[i] * XC5[i] + tiaC1[i] * XC6[i] + tiaC2[i] * XC7[i] + tiaC3[i] * XC8[i] + tiaC4[i] * XC9[i] + tiaC5[i] * XC10[i]) +
	   Cnn[i] * (tiaC0[i] * XC4[i] + tiaC1[i] * XC5[i] + tiaC2[i] * XC6[i] + tiaC3[i] * XC7[i] + tiaC4[i] * XC8[i] + tiaC5[i] * XC9[i]) +
	   Dnn[i] * (tiaC0[i] * XC3[i] + tiaC1[i] * XC4[i] + tiaC2[i] * XC5[i] + tiaC3[i] * XC6[i] + tiaC4[i] * XC7[i] + tiaC5[i] * XC8[i]) +
	   An[i] * (tiaC0[i] * CY6[i] + tiaC1[i] * CY7[i] + tiaC2[i] * CY8[i] + tiaC3[i] * CY9[i] + tiaC4[i] * CY10[i] + tiaC5[i] * CY11[i]) +
	   Bn[i] * (tiaC0[i] * CY5[i] + tiaC1[i] * CY6[i] + tiaC2[i] * CY7[i] + tiaC3[i] * CY8[i] + tiaC4[i] * CY9[i] + tiaC5[i] * CY10[i]) +
	   Cn[i] * (tiaC0[i] * CY4[i] + tiaC1[i] * CY5[i] + tiaC2[i] * CY6[i] + tiaC3[i] * CY7[i] + tiaC4[i] * CY8[i] + tiaC5[i] * CY9[i]) +
	   Dn[i] * (tiaC0[i] * CY3[i] + tiaC1[i] * CY4[i] + tiaC2[i] * CY5[i] + tiaC3[i] * CY6[i] + tiaC4[i] * CY7[i] + tiaC5[i] * CY8[i])
	   )))
                 };
vector iAsym[i] = Split{0.0,EMPTY[i] ? 0.0 :
	   min(1.0, max(0.0, (
	   Ann[i] * (igC0[i] * XC4[i] + igC1[i] * XC5[i] + igC2[i] * XC6[i] + igC3[i] * XC7[i] + igC4[i] * XC8[i] + igC5[i] * XC9[i]) +
	   Bnn[i] * (igC0[i] * XC3[i] + igC1[i] * XC4[i] + igC2[i] * XC5[i] + igC3[i] * XC6[i] + igC4[i] * XC7[i] + igC5[i] * XC8[i]) +
	   Cnn[i] * (igC0[i] * XC2[i] + igC1[i] * XC3[i] + igC2[i] * XC4[i] + igC3[i] * XC5[i] + igC4[i] * XC6[i] + igC5[i] * XC7[i]) +
	   Dnn[i] * (igC0[i] * XC1[i] + igC1[i] * XC2[i] + igC2[i] * XC3[i] + igC3[i] * XC4[i] + igC4[i] * XC5[i] + igC5[i] * XC6[i]) +
	   An[i] * (igC0[i] * CY4[i] + igC1[i] * CY5[i] + igC2[i] * CY6[i] + igC3[i] * CY7[i] + igC4[i] * CY8[i] + igC5[i] * CY9[i]) +
	   Bn[i] * (igC0[i] * CY3[i] + igC1[i] * CY4[i] + igC2[i] * CY5[i] + igC3[i] * CY6[i] + igC4[i] * CY7[i] + igC5[i] * CY8[i]) +
	   Cn[i] * (igC0[i] * CY2[i] + igC1[i] * CY3[i] + igC2[i] * CY4[i] + igC3[i] * CY5[i] + igC4[i] * CY6[i] + igC5[i] * CY7[i]) +
	   Dn[i] * (igC0[i] * CY1[i] + igC1[i] * CY2[i] + igC2[i] * CY3[i] + igC3[i] * CY4[i] + igC4[i] * CY5[i] + igC5[i] * CY6[i])
	   ) / Nk[i]))
                  };
vector uiAsym[i] = Split{0.0,EMPTY[i] ? 0.0 :
	   min(1.0, max(0.0, (
	   Ann[i] * (uigC0[i] * XC4[i] + uigC1[i] * XC5[i] + uigC2[i] * XC6[i] + uigC3[i] * XC7[i] + uigC4[i] * XC8[i] + uigC5[i] * XC9[i]) +
	   Bnn[i] * (uigC0[i] * XC3[i] + uigC1[i] * XC4[i] + uigC2[i] * XC5[i] + uigC3[i] * XC6[i] + uigC4[i] * XC7[i] + uigC5[i] * XC8[i]) +
	   Cnn[i] * (uigC0[i] * XC2[i] + uigC1[i] * XC3[i] + uigC2[i] * XC4[i] + uigC3[i] * XC5[i] + uigC4[i] * XC6[i] + uigC5[i] * XC7[i]) +
	   Dnn[i] * (uigC0[i] * XC1[i] + uigC1[i] * XC2[i] + uigC2[i] * XC3[i] + uigC3[i] * XC4[i] + uigC4[i] * XC5[i] + uigC5[i] * XC6[i]) +
	   An[i] * (uigC0[i] * CY4[i] + uigC1[i] * CY5[i] + uigC2[i] * CY6[i] + uigC3[i] * CY7[i] + uigC4[i] * CY8[i] + uigC5[i] * CY9[i]) +
	   Bn[i] * (uigC0[i] * CY3[i] + uigC1[i] * CY4[i] + uigC2[i] * CY5[i] + uigC3[i] * CY6[i] + uigC4[i] * CY7[i] + uigC5[i] * CY8[i]) +
	   Cn[i] * (uigC0[i] * CY2[i] + uigC1[i] * CY3[i] + uigC2[i] * CY4[i] + uigC3[i] * CY5[i] + uigC4[i] * CY6[i] + uigC5[i] * CY7[i]) +
	   Dn[i] * (uigC0[i] * CY1[i] + uigC1[i] * CY2[i] + uigC2[i] * CY3[i] + uigC3[i] * CY4[i] + uigC4[i] * CY5[i] + uigC5[i] * CY6[i])
	   ) / Nk[i]))
                   };
vector riAsym[i] = Split{0.0,EMPTY[i] ? 0.0 :
	   min(1.0, max(0.0, (
	   Ann[i] * (rigC0[i] * XC4[i] + rigC1[i] * XC5[i] + rigC2[i] * XC6[i] + rigC3[i] * XC7[i] + rigC4[i] * XC8[i] + rigC5[i] * XC9[i]) +
	   Bnn[i] * (rigC0[i] * XC3[i] + rigC1[i] * XC4[i] + rigC2[i] * XC5[i] + rigC3[i] * XC6[i] + rigC4[i] * XC7[i] + rigC5[i] * XC8[i]) +
	   Cnn[i] * (rigC0[i] * XC2[i] + rigC1[i] * XC3[i] + rigC2[i] * XC4[i] + rigC3[i] * XC5[i] + rigC4[i] * XC6[i] + rigC5[i] * XC7[i]) +
	   Dnn[i] * (rigC0[i] * XC1[i] + rigC1[i] * XC2[i] + rigC2[i] * XC3[i] + rigC3[i] * XC4[i] + rigC4[i] * XC5[i] + rigC5[i] * XC6[i]) +
	   An[i] * (rigC0[i] * CY4[i] + rigC1[i] * CY5[i] + rigC2[i] * CY6[i] + rigC3[i] * CY7[i] + rigC4[i] * CY8[i] + rigC5[i] * CY9[i]) +
	   Bn[i] * (rigC0[i] * CY3[i] + rigC1[i] * CY4[i] + rigC2[i] * CY5[i] + rigC3[i] * CY6[i] + rigC4[i] * CY7[i] + rigC5[i] * CY8[i]) +
	   Cn[i] * (rigC0[i] * CY2[i] + rigC1[i] * CY3[i] + rigC2[i] * CY4[i] + rigC3[i] * CY5[i] + rigC4[i] * CY6[i] + rigC5[i] * CY7[i]) +
	   Dn[i] * (rigC0[i] * CY1[i] + rigC1[i] * CY2[i] + rigC2[i] * CY3[i] + rigC3[i] * CY4[i] + rigC4[i] * CY5[i] + rigC5[i] * CY6[i])
	   ) / Nk[i]))
                   };
vector tiAsym[i] = Split{0.0,EMPTY[i] ? 0.0 :
	   min(1.0, max( 0.0, (
	   Ann[i] * (tigC0[i] * XC4[i] + tigC1[i] * XC5[i] + tigC2[i] * XC6[i] + tigC3[i] * XC7[i] + tigC4[i] * XC8[i] + tigC5[i] * XC9[i]) +
	   Bnn[i] * (tigC0[i] * XC3[i] + tigC1[i] * XC4[i] + tigC2[i] * XC5[i] + tigC3[i] * XC6[i] + tigC4[i] * XC7[i] + tigC5[i] * XC8[i]) +
	   Cnn[i] * (tigC0[i] * XC2[i] + tigC1[i] * XC3[i] + tigC2[i] * XC4[i] + tigC3[i] * XC5[i] + tigC4[i] * XC6[i] + tigC5[i] * XC7[i]) +
	   Dnn[i] * (tigC0[i] * XC1[i] + tigC1[i] * XC2[i] + tigC2[i] * XC3[i] + tigC3[i] * XC4[i] + tigC4[i] * XC5[i] + tigC5[i] * XC6[i]) +
	   An[i] * (tigC0[i] * CY4[i] + tigC1[i] * CY5[i] + tigC2[i] * CY6[i] + tigC3[i] * CY7[i] + tigC4[i] * CY8[i] + tigC5[i] * CY9[i]) +
	   Bn[i] * (tigC0[i] * CY3[i] + tigC1[i] * CY4[i] + tigC2[i] * CY5[i] + tigC3[i] * CY6[i] + tigC4[i] * CY7[i] + tigC5[i] * CY8[i]) +
	   Cn[i] * (tigC0[i] * CY2[i] + tigC1[i] * CY3[i] + tigC2[i] * CY4[i] + tigC3[i] * CY5[i] + tigC4[i] * CY6[i] + tigC5[i] * CY7[i]) +
	   Dn[i] * (tigC0[i] * CY1[i] + tigC1[i] * CY2[i] + tigC2[i] * CY3[i] + tigC3[i] * CY4[i] + tigC4[i] * CY5[i] + tigC5[i] * CY6[i])
	   ) / Nk[i]))
                   };

vector iAlbedo[i] = Split{0.0,EMPTY[i] ? 0.0 : min(1.0, max(0.0, (iBeta[i] - iAbs[i]) / iBeta[i]))};
vector uiAlbedo[i] = Split{0.0,EMPTY[i] ? 0.0 : min(1.0, max(0.0, (uiBeta[i] - uiAbs[i]) / uiBeta[i]))};
vector riAlbedo[i] = Split{0.0,EMPTY[i] ? 0.0 : min(1.0, max(0.0, (riBeta[i] - riAbs[i]) / riBeta[i]))};
vector tiAlbedo[i] = Split{0.0,EMPTY[i] ? 0.0 : min(1.0, max(0.0, (tiBeta[i] - tiAbs[i]) / tiBeta[i]))};

double eBeta = min(1E-2/max(HX[x],max(HY[y], HZ[z])), @AirBeta+Sum{iBeta[i]});
double eScat = min(eBeta, @AirAlbedo*@AirBeta+Sum{iAlbedo[i]*iBeta[i]});
double kAlbedo = min(1.0, eScat/eBeta);
double kAsymm = min(1.0, (@AirAlbedo*@AirBeta*@AirAsymmetry+Sum{iAlbedo[i]*iBeta[i]*iAsym[i]})/eScat);

double ueBeta = min(1E-2/max(HX[x],max(HY[y], HZ[z])), @uAirBeta+Sum{uiBeta[i]});
double ueScat = min(ueBeta, @uAirAlbedo*@uAirBeta+Sum{uiAlbedo[i]*uiBeta[i]});
double ukAlbedo = min(1.0, ueScat/ueBeta);
double ukAsymm = min(1.0, (@uAirAlbedo*@uAirBeta*@uAirAsymmetry+Sum{uiAlbedo[i]*uiBeta[i]*uiAsym[i]})/ueScat);

double reBeta = min(1E-2/max(HX[x],max(HY[y], HZ[z])), @rAirBeta+Sum{riBeta[i]});
double reScat = min(reBeta, @rAirAlbedo*@rAirBeta+Sum{riAlbedo[i]*riBeta[i]});
double rkAlbedo = min(1.0, reScat/reBeta);
double rkAsymm = min(1.0, (@rAirAlbedo*@rAirBeta*@rAirAsymmetry+Sum{riAlbedo[i]*riBeta[i]*riAsym[i]})/reScat);

double teBeta = min(1E-2/max(HX[x],max(HY[y], HZ[z])), @tAirBeta+Sum{tiBeta[i]});
double teScat = min(teBeta, @tAirAlbedo*@tAirBeta+Sum{tiAlbedo[i]*tiBeta[i]});
double tkAlbedo = min(1.0, teScat/teBeta);
double tkAsymm = min(1.0, (@tAirAlbedo*@tAirBeta*@tAirAsymmetry+Sum{tiAlbedo[i]*tiBeta[i]*tiAsym[i]})/teScat);

vector Dz2[i] = Dz[i]*Dz[i];
vector Dz3[i] = Dz2[i]*Dz[i];
vector Dzz2[i] = Dzz[i]*Dzz[i];
vector Dzz3[i] = Dzz2[i]*Dzz[i];
vector LDz[i] = EMPTY[i] || Mode[i]==0.0 ? 0.0 : LX[i]&lt;0 ? LY[i] : 0.5*ROK*(1E6*Source/PkF-exp(PkF1/Dz[i]-PkF2[i]/(Dz[i]*Dz[i]*Dz[i])))/(PkF3[i]/Dvap0*(1.0+Dvap1/Dz[i])+PkF4[i]/Lambda0*(1.0+Lambda1/Dz[i]));
vector nDz[i] = EMPTY[i] ? 0.0 : LX[i]&lt;0 ? nY[i] : An[i] * Dz3[i] + Bn[i] * Dz2[i] + Cn[i] * Dz[i] + Dn[i];
vector LDzz[i] = EMPTY[i] || Mode[i]==0.0 ? 0.0 : LX[i]&lt;0 ? 0.5*ROK*(1E6*Source/PkF-exp(PkF1/Dzz[i]-PkF2[i]/(Dzz[i]*Dzz[i]*Dzz[i])))/(PkF3[i]/Dvap0*(1.0+Dvap1/Dzz[i])+PkF4[i]/Lambda0*(1.0+Lambda1/Dzz[i])) : LX[i];
vector nDzz[i] = EMPTY[i] ? 0.0 : LX[i]&lt;0 ? Ann[i] * Dzz3[i] + Bnn[i] * Dzz2[i] + Cnn[i] * Dzz[i] + Dnn[i] : nX[i];
vector Dz4[i] = Dz3[i]*Dz[i];
vector Dz5[i] = Dz4[i]*Dz[i];
vector Dzz4[i] = Dzz3[i]*Dzz[i];
vector Dzz5[i] = Dzz4[i]*Dzz[i];
vector Dz6[i] = Dz5[i] * Dz[i];
vector Dzz6[i] = Dzz5[i] * Dzz[i];
vector Dz7[i] = Dz6[i] * Dz[i];
vector Dzz7[i] = Dzz6[i] * Dzz[i];
vector _PhiM[i] = EMPTY[i] ? 0.0 : Pi*0.5*(nDzz[i] * LDzz[i] * Dzz[i] + nX[i] * LX[i] * X[i])*(Dzz[i] - X[i]);
vector PhiM[i] = EMPTY[i] ? 0.0 : fabs(Rok[i]*(Dzz[i] - X[i])/(Y[i]-X[i]) / TAU) &lt; fabs(_PhiM[i]) ? sign(0.5*(LX[i]+LDzz[i]))*max(0.0, Rok[i]*(Dzz[i] - X[i])/(Y[i]-X[i]) / TAU) : _PhiM[i];
vector _PhiP[i] = EMPTY[i] ? 0.0 : Pi*0.5*(nY[i] * LY[i] * Y[i] + nDz[i] * LDz[i] * Dz[i])*(Y[i] - Dz[i]);
vector PhiP[i] = EMPTY[i] ? 0.0 : fabs(Rok[i]*(Y[i] - Dz[i])/(Y[i]-X[i]) / TAU) &lt; fabs(_PhiP[i]) ? sign(0.5*(LY[i]+LDz[i]))*max(0.0, Rok[i]*(Y[i] - Dz[i])/(Y[i]-X[i]) / TAU) : _PhiP[i];
vector NkM[i] = EMPTY[i] ? 0.0 : max(0.0, min(Nk[i]*(Dzz[i]-X[i])/(Y[i]-X[i]), Ann[i] / 4.0*(Dzz4[i] - X4[i]) + Bnn[i] / 3.0*(Dzz3[i] - X3[i]) + Cnn[i] / 2.0*(Dzz2[i] - X2[i]) + Dnn[i] * (Dzz[i] - X[i])));
vector NkP[i] = EMPTY[i] ? 0.0 : max(0.0, min(Nk[i]*(Y[i]-Dz[i])/(Y[i]-X[i]), An[i] / 4.0*(Y4[i] - Dz4[i]) + Bn[i] / 3.0*(Y3[i] - Dz3[i]) + Cn[i] / 2.0*(Y2[i] - Dz2[i]) + Dn[i] * (Y[i] - Dz[i])));
vector RZ[i] = EMPTY[i] ? 0.0 : max(0.0, min(Pi*Nk[i]*(Dz[i] - Dzz[i]), Pi*(
	An[i] / 5.0*(Dz5[i] - XYC5[i]) + Bn[i] / 4.0*(Dz4[i] - XYC4[i]) + Cn[i] / 3.0*(Dz3[i] - XYC3[i]) + Dn[i] / 2.0*(Dz2[i] - XYC2[i]) +
	Ann[i] / 5.0*(XYC5[i] - Dzz5[i]) + Bnn[i] / 4.0*(XYC4[i] - Dzz4[i]) + Cnn[i] / 3.0*(XYC3[i] - Dzz3[i]) + Dnn[i] / 2.0*(XYC2[i] - Dzz2[i])
	)));
vector RM[i] = EMPTY[i] ? 0.0 : max(0.0, min(Pi*Nk[i]*(Dzz[i]-X[i]), Pi*(Ann[i] / 5.0*(Dzz5[i] - X5[i]) + Bnn[i] / 4.0*(Dzz4[i] - X4[i]) + Cnn[i] / 3.0*(Dzz3[i] - X3[i]) + Dnn[i] / 2.0*(Dzz2[i] - X2[i]))));
vector RP[i] = EMPTY[i] ? 0.0 : max(0.0, min(Pi*Nk[i]*(Y[i]-Dz[i]), Pi*(An[i] / 5.0*(Y5[i] - Dz5[i]) + Bn[i] / 4.0*(Y4[i] - Dz4[i]) + Cn[i] / 3.0*(Y3[i] - Dz3[i]) + Dn[i] / 2.0*(Y2[i] - Dz2[i]))));
vector X1[i] = EMPTY[i] ? X[i] : LX[i]&lt;0 ? X[i] : X[i]+TAU*2.0*LX[i]/ROK/X[i];
vector Y1[i] = EMPTY[i] ? Y[i] : LX[i]&lt;0 ? Y[i]+TAU*2.0*LY[i]/ROK/Y[i] : Y[i];
vector PhiZ[i] = RZ[i]*LDp[i];
vector RokM[i] = EMPTY[i] ? 0.0 : max(0.0, min(Rok[i], Pi / 6.0*ROK*(Ann[i] / 7.0*(Dzz7[i] - X7[i]) + Bnn[i] / 6.0*(Dzz6[i] - X6[i]) + Cnn[i] / 5.0*(Dzz5[i] - X5[i]) + Dnn[i] / 4.0*(Dzz4[i] - X4[i]))));
vector RokP[i] = EMPTY[i] ? 0.0 : max(0.0, min(Rok[i], Pi / 6.0*ROK*(An[i] / 7.0*(Y7[i] - Dz7[i]) + Bn[i] / 6.0*(Y6[i] - Dz6[i]) + Cn[i] / 5.0*(Y5[i] - Dz5[i]) + Dn[i] / 4.0*(Y4[i] - Dz4[i]))));
vector pdNk[i] = 1.0/TAU*(-NkP[i]-NkM[i])+
                 (i&gt;0.0 ? 1.0/TAU*NkP[i-1] : 0.0)+
                 (i&lt;Nc-1 ? 1.0/TAU*NkM[i+1] : 0.0);
vector TOZERO[i] = X1[i]&gt;=@Dk[i+1] || Y1[i]&lt;=@Dk[i] || (Nk[i]&lt;1.0 &amp;&amp; pdNk[i]&lt;=0.0);
double dC = Sum{PhiZ[i]}+Sum{1,Nc-1,PhiP[i-1]}+Sum{0,Nc-2,PhiM[i+1]};

vector ddN[i] = 0.0;
vector dRo[i] = 0.0;
vector(Nc*Nc+Nc) ddRo[i] = 0.0;
double coalesc = calcCoalescense(Nc, Dk, X, Y, XYC, Ann, Bnn, Cnn, Dnn, An, Bn, Cn, Dn, Ptr, Ukx, Uky, Ukz, UwLight, ROK, ddN, dRo, ddRo);
</Parameter>
    <Parameter ID="Expression" Indent="0">Split{-1E-6/Mk*dC,0.0};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="Drops" ContID="SourceK" Color="clYellow" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="K_Rok" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="516" Top="1777"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">vector dUkxdx[i] = Split{0.0,dFdx(Ukx[i])};
vector dUkydy[i] = Split{0.0,dFdy(Uky[i])};
vector dUkzdz[i] = Split{0.0,dFdz(Ukz[i])};
vector dRok[i] = TOZERO[i] ? -Rok[i]/TAU :
                   PhiZ[i]+1.0/TAU*(-RokP[i]-RokM[i])+
                   (i&gt;0.0 ? PhiP[i-1]+1.0/TAU*RokP[i-1] : 0.0)+
                   (i&lt;Nc-1 ? PhiM[i+1]+1.0/TAU*RokM[i+1] : 0.0);
</Parameter>
    <Parameter ID="Expression" Indent="0">Split{dRok[i]+dRo[i],0.0};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqRok" ContID="K" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="S_Rok" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="487" Top="1862"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">vector dUkxdx[i] = Split{0.0,dFdx(Ukx[i])};
vector dUkydy[i] = Split{0.0,dFdy(Uky[i])};
vector dUkzdz[i] = Split{0.0,dFdz(Ukz[i])};
vector dRok[i] = TOZERO[i] ? -Rok[i]/TAU :
                   PhiZ[i]+1.0/TAU*(-RokP[i]-RokM[i])+
                   (i&gt;0.0 ? PhiP[i-1]+1.0/TAU*RokP[i-1] : 0.0)+
                   (i&lt;Nc-1 ? PhiM[i+1]+1.0/TAU*RokM[i+1] : 0.0);
</Parameter>
    <Parameter ID="Expression" Indent="0">Split{0.0,0.0};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqRok" ContID="S" Color="clYellow" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Var" ParentID="" ID="Nk" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="392" Top="2097"/>
   <Parameters NumItems="4">
    <Parameter ID="Init" Indent="0">@[]InitNk{Drops}[i]</Parameter>
    <Parameter ID="Restrict" Indent="0">Positive</Parameter>
    <Parameter ID="FBase" Indent="0">nk</Parameter>
    <Parameter ID="Desc" Indent="0">Концентрация капель</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Phase">
     <Link ElementID="Drops" ContID="Define" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="EqNk" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_DynEquation" ParentID="" ID="EqNk" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="697" Top="2143"/>
   <Parameters NumItems="3">
    <Parameter ID="Handler" Indent="0">NULL</Parameter>
    <Parameter ID="NuMol" Indent="0">0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0</Parameter>
    <Parameter ID="Kappa" Indent="0">0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="Nk" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="K_Nk" ContID="Val" Informational="False"/>
     <Link ElementID="Inject_Nk" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="S">
     <Link ElementID="S_Nk" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Solver">
     <Link ElementID="Solver" ContID="Eqtn" Color="#C08000" Informational="False">
      <Points NumItems="2">844,2194,844,423</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="K_Nk" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="536" Top="2160"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">vector dUkxdx[i] = Split{0.0,dFdx(Ukx[i])};
vector dUkydy[i] = Split{0.0,dFdy(Uky[i])};
vector dUkzdz[i] = Split{0.0,dFdz(Ukz[i])};
vector dNk[i] = TOZERO[i] ? -Nk[i]/TAU : pdNk[i];
</Parameter>
    <Parameter ID="Expression" Indent="0">Split{dNk[i]+ddN[i],0.0};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqNk" ContID="K" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="S_Nk" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="572" Top="2244"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">vector dUkxdx[i] = Split{0.0,dFdx(Ukx[i])};
vector dUkydy[i] = Split{0.0,dFdy(Uky[i])};
vector dUkzdz[i] = Split{0.0,dFdz(Ukz[i])};
vector dNk[i] = TOZERO[i] ? -Nk[i]/TAU : pdNk[i];
</Parameter>
    <Parameter ID="Expression" Indent="0">Split{0.0,0.0};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqNk" ContID="S" Color="clYellow" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="K_Drops_SO2" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="490" Top="962"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">vector CTOZERO[i] = SO2k[i] + TAU*(1E-6*dSO2kg[i] + ddSO2kg[i] + SO2k[i] * (1E-6*dSO2kf[i] + ddSO2kf[i])) &lt; 0;
vector CTOMAX[i] = SO2k[i] + TAU*(1E-6*dSO2kg[i] + ddSO2kg[i] + SO2k[i] * (1E-6*dSO2kf[i] + ddSO2kf[i])) &gt; maxSO2k[i];
double dSO2 = Sum{0,Nc-1,(CTOZERO[i] ? 0.0 : (RZ[i] * (LSO2f[i] * max(0.0, SO2k[i]) + LSO2g[i])))}+
              Sum{1,Nc-1,(CTOZERO[i-1] ? 0.0 : (RP[i-1] * (LSO2f[i-1] * max(0.0, SO2k[i-1]) + LSO2g[i-1])))}+
              Sum{0,Nc-2,(CTOZERO[i+1] ? 0.0 : (RM[i+1] * (LSO2f[i+1] * max(0.0, SO2k[i+1]) + LSO2g[i+1])))};
</Parameter>
    <Parameter ID="Expression" Indent="0">Split{-1E-6*dSO2,0.0};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Phase">
     <Link ElementID="Drops" ContID="Define" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqSO2" ContID="K" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Var" ParentID="" ID="SO2k" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="394" Top="2250"/>
   <Parameters NumItems="4">
    <Parameter ID="Init" Indent="0">@[]InitSO2k{Drops}[i]</Parameter>
    <Parameter ID="Restrict" Indent="0">Positive</Parameter>
    <Parameter ID="FBase" Indent="0">so2k</Parameter>
    <Parameter ID="Desc" Indent="0">Концентрация SO2 в каплях</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Phase">
     <Link ElementID="Drops" ContID="Define" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Calc">
     <Link ElementID="EqSO2k" ContID="Calc" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_DynEquation" ParentID="" ID="EqSO2k" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="696" Top="2257"/>
   <Parameters NumItems="3">
    <Parameter ID="Handler" Indent="0">NULL</Parameter>
    <Parameter ID="NuMol" Indent="0">0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0</Parameter>
    <Parameter ID="Kappa" Indent="0">0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks>
    <Contact ID="Calc">
     <Link ElementID="SO2k" ContID="Calc" Informational="False"/>
    </Contact>
    <Contact ID="K">
     <Link ElementID="K_SO2k" ContID="Val" Informational="False"/>
    </Contact>
    <Contact ID="S">
     <Link ElementID="S_SO2k" ContID="Val" Informational="False"/>
    </Contact>
   </InputLinks>
   <OutputLinks>
    <Contact ID="Solver">
     <Link ElementID="Solver" ContID="Eqtn" Color="#808040" Informational="False">
      <Points NumItems="2">852,2308,852,448</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="K_SO2k" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="570" Top="2299"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double H298_SO2 = 0.012177;
double dH_SO2 = -25942.8;
double _DfSO2 = 5.518E-10*pow(TK,1.75);

double ScSO2 = @D/_DfSO2;
double tScSO2 = pow(ScSO2,1.0/3.0);
vector Nuss1SO2[i] = fabs(@UwLight[i]) &gt; 1E-8 ? 2.0 : 2.0 + 0.6*sRek[i] * tScSO2;
vector _HenrySO2[i] = EMPTY[i] ? 0.0 : H298_SO2*exp(dH_SO2/_R*(1.0/298.0-1/TK))*_R*TK;
vector LSO2f[i] = EMPTY[i] ? 0.0 : -Nuss1SO2[i] * _DfSO2*1E6*kCSubst[i] / _HenrySO2[i];
vector LSO2g[i] = EMPTY[i] ? 0.0 : Nuss1SO2[i] * _DfSO2*1E6*max(0.0, SO2);
vector maxSO2k[i] = EMPTY[i] ? 0.0 : max(0.0, SO2)*_HenrySO2[i] / kCSubst[i];
vector dSO2kf[i] = TOZERO[i] ? 0.0 :
                     RZ[i]*LSO2f[i]+1E6/(TAU*ROK)*(-RokP[i]-RokM[i])+
                     (i&gt;0 ? RP[i-1]*LSO2f[i-1]+1E6/TAU*RokP[i-1]/ROK : 0.0)+
                     (i&lt;Nc-1 ? RM[i+1]*LSO2f[i+1]+1E6/TAU*RokM[i+1]/ROK : 0.0);
vector dSO2kg[i] = TOZERO[i] ? -1E6*SO2k[i]/TAU :
                     RZ[i]*LSO2g[i]+
                     (i&gt;0 ? RP[i-1]*LSO2g[i-1] : 0.0)+
                     (i&lt;Nc-1 ? RM[i+1]*LSO2g[i+1] : 0.0);
vector ddSO2kg[i] = 0*coalesc + (Sum{0,Nc-1,i != j ? SO2k[j]*ddRo[j*(Nc+1)+i] : 0.0;j})/ROK;
vector ddSO2kf[i] = 0*coalesc + (ddRo[i*(Nc+1)+i] + ddRo[i*(Nc+1)+Nc])/ROK;
</Parameter>
    <Parameter ID="Expression" Indent="0">Split{(CTOZERO[i] ? -SO2k[i] / TAU : CTOMAX[i] ? maxSO2k[i]/TAU : (1E-6*dSO2kg[i] + ddSO2kg[i])),0.0};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqSO2k" ContID="K" Color="clBlack" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="S_SO2k" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="570" Top="2346"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double H298_SO2 = 0.012177;
double dH_SO2 = -25942.8;
double _DfSO2 = 5.518E-10*pow(TK,1.75);

double ScSO2 = @D/_DfSO2;
double tScSO2 = pow(ScSO2,1.0/3.0);
vector Nuss1SO2[i] = fabs(@UwLight[i]) &gt; 1E-8 ? 2.0 : 2.0 + 0.6*sRek[i] * tScSO2;
vector _HenrySO2[i] = EMPTY[i] ? 0.0 : H298_SO2*exp(dH_SO2/_R*(1.0/298.0-1/TK))*_R*TK;
vector LSO2f[i] = EMPTY[i] ? 0.0 : -Nuss1SO2[i] * _DfSO2*1E6*kCSubst[i] / _HenrySO2[i];
vector LSO2g[i] = EMPTY[i] ? 0.0 : Nuss1SO2[i] * _DfSO2*1E6*max(0.0, SO2);
vector maxSO2k[i] = EMPTY[i] ? 0.0 : max(0.0, SO2)*_HenrySO2[i] / kCSubst[i];
vector dSO2kf[i] = TOZERO[i] ? 0.0 :
                     RZ[i]*LSO2f[i]+1E6/(TAU*ROK)*(-RokP[i]-RokM[i])+
                     (i&gt;0 ? RP[i-1]*LSO2f[i-1]+1E6/TAU*RokP[i-1]/ROK : 0.0)+
                     (i&lt;Nc-1 ? RM[i+1]*LSO2f[i+1]+1E6/TAU*RokM[i+1]/ROK : 0.0);
vector dSO2kg[i] = TOZERO[i] ? -1E6*SO2k[i]/TAU :
                     RZ[i]*LSO2g[i]+
                     (i&gt;0 ? RP[i-1]*LSO2g[i-1] : 0.0)+
                     (i&lt;Nc-1 ? RM[i+1]*LSO2g[i+1] : 0.0);
vector ddSO2kg[i] = 0*coalesc + (Sum{0,Nc-1,i != j ? SO2k[j]*ddRo[j*(Nc+1)+i] : 0.0;j})/ROK;
vector ddSO2kf[i] = 0*coalesc + (ddRo[i*(Nc+1)+i] + ddRo[i*(Nc+1)+Nc])/ROK;
</Parameter>
    <Parameter ID="Expression" Indent="0">Split{(CTOZERO[i] ? 0.0 : CTOMAX[i] ? -1.0/TAU : (1E-6*dSO2kf[i] + ddSO2kf[i])),0.0};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqSO2k" ContID="S" Color="clYellow" Informational="False">
      <Points NumItems="0"/>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="Inject_Rok" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="454" Top="1820"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double YCell = floor((ModelTime-@InjectStartTime{Drops})*@InjectV{Drops}/@InjectCellLength{Drops});</Parameter>
    <Parameter ID="Expression" Indent="0">Split{0.0,_Z[0]==0.0 &amp;&amp; z==1 &amp;&amp; @InjectStartTime{Drops}&lt;=ModelTime ? (
   EMPTY[i] ? @[]InjectN{Drops}[i]/24.0/(@Dk[i+1]-@Dk[i])*Pi*ROK*(@Dk[i+1]*@Dk[i+1]*@Dk[i+1]*@Dk[i+1]-@Dk[i]*@Dk[i]*@Dk[i]*@Dk[i]) :
   @InjectN[i] / 6.0 / XY1[i] * Pi*ROK*XY4[i]
) : 0.0};
</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqRok" ContID="K" Color="#C080FF" Informational="False">
      <Points NumItems="1">569,1845</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Function" ParentID="" ID="Inject_Nk" Permanent="False">
   <Show Class="False" Name="True" Image="False"/>
   <Position Left="544" Top="2202"/>
   <Parameters NumItems="2">
    <Parameter ID="Vars" Indent="0">double YCell = floor((ModelTime-@InjectStartTime{Drops})*@InjectV{Drops}/@InjectCellLength{Drops});</Parameter>
    <Parameter ID="Expression" Indent="0">Split{0.0,_Z[0]==0.0 &amp;&amp; z==1 &amp;&amp; @InjectStartTime{Drops}&lt;=ModelTime ? @[]InjectN{Drops}[i] : 0.0};</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks>
    <Contact ID="Val">
     <Link ElementID="EqNk" ContID="K" Color="#C080FF" Informational="False">
      <Points NumItems="1">645,2227</Points>
     </Link>
    </Contact>
   </OutputLinks>
  </Element>
  <Element ClassID="clsE_Export" ParentID="" ID="EXP" Permanent="False">
   <Show Class="True" Name="True" Image="False"/>
   <Position Left="31" Top="19"/>
   <Parameters NumItems="2">
    <Parameter ID="Lang" Indent="0">Russian</Parameter>
    <Parameter ID="ClassPath" Indent="0">clsE_Element\clsE_Surrogate</Parameter>
   </Parameters>
   <InternalInputs NumItems="0"/>
   <InternalOutputs NumItems="0"/>
   <PublishedInputs NumItems="0"/>
   <PublishedOutputs NumItems="0"/>
   <InputLinks/>
   <OutputLinks/>
  </Element>
 </Elements>
</System>
